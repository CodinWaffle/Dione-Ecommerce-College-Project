<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Color Selection</title>
    <style>
        .color-option {
            width: 50px;
            height: 50px;
            border: 2px solid #ccc;
            border-radius: 50%;
            margin: 10px;
            cursor: pointer;
            display: inline-block;
        }
        .color-option.active {
            border: 3px solid #000;
            transform: scale(1.1);
        }
        .size-options {
            margin: 20px 0;
        }
        .size-option {
            padding: 10px 15px;
            margin: 5px;
            border: 1px solid #ccc;
            background: white;
            cursor: pointer;
        }
        .size-option.active {
            background: #8e44ad;
            color: white;
        }
        .loading-sizes {
            color: #666;
            font-style: italic;
        }
    </style>
</head>
<body>
    <h1>Test Color Selection Functionality</h1>
    
    <div class="color-section">
        <label>COLOR: <span class="selected-color">Select Color</span></label>
        <div class="color-options">
            <button type="button" class="color-option" 
                    data-color="Digital Lavender" 
                    data-color-hex="#b19cd9"
                    onclick="selectColor(this)"
                    style="background-color: #b19cd9;">
            </button>
            <button type="button" class="color-option" 
                    data-color="Black" 
                    data-color-hex="#000000"
                    onclick="selectColor(this)"
                    style="background-color: #000000;">
            </button>
            <button type="button" class="color-option" 
                    data-color="Cool White" 
                    data-color-hex="#ffffff"
                    onclick="selectColor(this)"
                    style="background-color: #ffffff; border-color: #000;">
            </button>
        </div>
    </div>

    <div class="size-section">
        <label>SIZE</label>
        <div class="size-options" id="sizeOptions">
            <div class="size-placeholder">Select a color to view available sizes</div>
        </div>
    </div>

    <div id="debug-info">
        <h3>Debug Info:</h3>
        <div id="debug-output"></div>
    </div>

    <script>
        // Mock the necessary global variables and functions
        window.productId = 38; // Test product ID
        let currentSelectedColor = null;

        // Mock updateStockDisplay function
        function updateStockDisplay() {
            console.log('updateStockDisplay called');
            document.getElementById('debug-output').innerHTML += '<br>‚úÖ updateStockDisplay called';
        }

        // Mock hexToRgba function
        function hexToRgba(hex, alpha) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return `rgba(${r}, ${g}, ${b}, ${alpha})`;
        }

        // Mock updateSizeAvailability function (simplified version)
        function updateSizeAvailability() {
            console.log('updateSizeAvailability called');
            document.getElementById('debug-output').innerHTML += '<br>‚úÖ updateSizeAvailability called';
            
            const activeColorBtn = document.querySelector(".color-option.active");
            const sizeOptionsContainer = document.getElementById("sizeOptions");

            if (activeColorBtn && sizeOptionsContainer) {
                const selectedColor = activeColorBtn.dataset.color;
                console.log('Selected color:', selectedColor);
                document.getElementById('debug-output').innerHTML += `<br>üé® Selected color: ${selectedColor}`;
                
                // Show loading state
                sizeOptionsContainer.innerHTML = '<div class="loading-sizes">Loading sizes...</div>';
                
                // Simulate API call
                setTimeout(() => {
                    // Mock different sizes for different colors
                    let mockSizes = {};
                    if (selectedColor === 'Digital Lavender') {
                        mockSizes = {'XS': {stock: 10}, 'S': {stock: 15}, 'M': {stock: 20}, 'L': {stock: 25}};
                    } else if (selectedColor === 'Black') {
                        mockSizes = {'S': {stock: 0}, 'M': {stock: 30}, 'L': {stock: 15}, 'XL': {stock: 25}};
                    } else if (selectedColor === 'Cool White') {
                        mockSizes = {'M': {stock: 25}, 'XXL': {stock: 30}};
                    }
                    
                    // Clear loading state and show sizes
                    sizeOptionsContainer.innerHTML = '';
                    
                    Object.keys(mockSizes).forEach(size => {
                        const sizeInfo = mockSizes[size];
                        const stock = sizeInfo.stock || 0;
                        const isAvailable = stock > 0;

                        const sizeBtn = document.createElement("button");
                        sizeBtn.className = `size-option ${!isAvailable ? "out-of-stock" : ""}`;
                        sizeBtn.setAttribute("data-size", size);
                        sizeBtn.setAttribute("data-stock", stock);
                        sizeBtn.textContent = size;
                        sizeBtn.title = `${size} - ${stock} in stock`;

                        if (!isAvailable) {
                            sizeBtn.style.opacity = '0.5';
                            sizeBtn.style.textDecoration = 'line-through';
                        }

                        sizeOptionsContainer.appendChild(sizeBtn);
                    });
                    
                    document.getElementById('debug-output').innerHTML += `<br>üìè Loaded ${Object.keys(mockSizes).length} sizes: ${Object.keys(mockSizes).join(', ')}`;
                }, 500); // Simulate network delay
            }
        }

        // The actual selectColor function from the fixed code
        function selectColor(colorBtn) {
            console.log("selectColor called with:", colorBtn);
            document.getElementById('debug-output').innerHTML = 'üîÑ selectColor called';

            // Ensure we have a valid button element
            if (!colorBtn || !colorBtn.dataset) {
                console.error("Invalid color button element");
                document.getElementById('debug-output').innerHTML += '<br>‚ùå Invalid color button element';
                return;
            }

            const colorOptions = document.querySelectorAll(".color-option");
            const selectedColorSpan = document.querySelector(".selected-color");

            colorOptions.forEach((option) => option.classList.remove("active"));
            colorBtn.classList.add("active");

            selectedColorSpan.textContent = colorBtn.dataset.color;
            currentSelectedColor = colorBtn.dataset.color;

            document.getElementById('debug-output').innerHTML += `<br>üé® Color selected: ${currentSelectedColor}`;

            // Set CSS custom properties for dynamic color scheme
            const colorHex = colorBtn.dataset.colorHex || "#8e44ad";
            const root = document.documentElement;
            root.style.setProperty("--selected-color", colorHex);

            // Create lighter version for hover effects
            const lightColor = hexToRgba(colorHex, 0.1);
            const shadowColor = hexToRgba(colorHex, 0.4);
            root.style.setProperty("--selected-color-light", lightColor);
            root.style.setProperty("--selected-color-shadow", shadowColor);

            // Update size availability and stock display
            updateSizeAvailability();
            updateStockDisplay();
        }

        // Make function globally accessible
        window.selectColor = selectColor;
        
        console.log('Test page loaded. Click on colors to test functionality.');
        document.getElementById('debug-output').innerHTML = '‚úÖ Test page loaded. Click on colors to test functionality.';
    </script>
</body>
</html>