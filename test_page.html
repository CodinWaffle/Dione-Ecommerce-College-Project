<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test Product Creation</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
      }
      .test-section {
        background: #f5f5f5;
        padding: 20px;
        margin: 20px 0;
        border-radius: 8px;
      }
      button {
        background: #007bff;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
      button:hover {
        background: #0056b3;
      }
      .result {
        margin-top: 10px;
        padding: 10px;
        border-radius: 4px;
      }
      .success {
        background: #d4edda;
        color: #155724;
      }
      .error {
        background: #f8d7da;
        color: #721c24;
      }
      .info {
        background: #d1ecf1;
        color: #0c5460;
      }

      pre {
        background: #f8f9fa;
        padding: 10px;
        border-radius: 4px;
        overflow-x: auto;
        white-space: pre-wrap;
      }
    </style>
  </head>
  <body>
    <h1>üß™ Product Creation Test Page</h1>
    <p>
      This page tests the complete product creation flow to ensure all form data
      is properly saved to the database.
    </p>

    <div class="test-section">
      <h2>üìä Session Storage Test</h2>
      <p>Test session storage functionality:</p>
      <button onclick="setupSessionStorage()">
        Setup Test Data in Session Storage
      </button>
      <button onclick="checkSessionStorage()">Check Session Storage</button>
      <button onclick="clearSessionStorage()">Clear Session Storage</button>
      <div id="sessionResult" class="result"></div>
    </div>

    <div class="test-section">
      <h2>üöÄ Product Creation Test</h2>
      <p>Test the complete product creation endpoint:</p>
      <button onclick="testProductCreation()">Test Product Creation</button>
      <div id="creationResult" class="result"></div>
    </div>

    <div class="test-section">
      <h2>üîç Database Verification</h2>
      <p>Check what's in the database:</p>
      <button onclick="checkDatabase()">Check Recent Products</button>
      <div id="databaseResult" class="result"></div>
    </div>

    <script>
      // Test data that matches the expected workflow structure
      const TEST_WORKFLOW_DATA = {
        step1: {
          productName: "Test Premium T-Shirt",
          category: "Fashion",
          subcategory: "T-Shirts",
          price: "49.99",
          discountType: "percentage",
          discountPercentage: "10",
          voucherType: "",
          lowStockThreshold: "5",
          primaryImage: "data:image/jpeg;base64,/9j/test_image_data...",
          secondaryImage: null,
          subitem: [],
        },
        step2: {
          description: "Premium quality cotton t-shirt with modern fit",
          materials: "100% Organic Cotton",
          detailsFit: "Modern fit, pre-shrunk",
          sizeGuide: ["XS", "S", "M", "L", "XL"],
          certifications: ["OEKO-TEX", "Organic Cotton"],
        },
        step3: {
          variants: [
            {
              sku: "PTS-BLK-01",
              color: "Black",
              colorHex: "#000000",
              lowStock: 5,
              photo: "data:image/jpeg;base64,/9j/test_variant_data...",
              sizeStocks: [
                { size: "S", stock: 10 },
                { size: "M", stock: 15 },
                { size: "L", stock: 8 },
              ],
            },
            {
              sku: "PTS-WHT-02",
              color: "White",
              colorHex: "#ffffff",
              lowStock: 3,
              photo: "data:image/jpeg;base64,/9j/test_variant2_data...",
              sizeStocks: [
                { size: "S", stock: 12 },
                { size: "M", stock: 20 },
                { size: "L", stock: 6 },
              ],
            },
          ],
          totalStock: 71,
        },
      };

      function setupSessionStorage() {
        try {
          sessionStorage.setItem(
            "productData",
            JSON.stringify(TEST_WORKFLOW_DATA)
          );
          showResult(
            "sessionResult",
            "‚úÖ Test data added to session storage successfully!",
            "success"
          );
        } catch (e) {
          showResult(
            "sessionResult",
            "‚ùå Error setting session storage: " + e.message,
            "error"
          );
        }
      }

      function checkSessionStorage() {
        try {
          const data = sessionStorage.getItem("productData");
          if (data) {
            const parsed = JSON.parse(data);
            showResult(
              "sessionResult",
              `‚úÖ Session storage contains data:\n${JSON.stringify(
                parsed,
                null,
                2
              )}`,
              "info"
            );
          } else {
            showResult(
              "sessionResult",
              "‚ö†Ô∏è No product data found in session storage",
              "error"
            );
          }
        } catch (e) {
          showResult(
            "sessionResult",
            "‚ùå Error reading session storage: " + e.message,
            "error"
          );
        }
      }

      function clearSessionStorage() {
        sessionStorage.removeItem("productData");
        showResult("sessionResult", "üóëÔ∏è Session storage cleared", "info");
      }

      async function testProductCreation() {
        try {
          showResult(
            "creationResult",
            "üöÄ Sending product creation request...",
            "info"
          );

          const response = await fetch("/seller/add_product_stocks", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              "X-Requested-With": "XMLHttpRequest",
            },
            body: JSON.stringify(TEST_WORKFLOW_DATA),
          });

          console.log("Response status:", response.status);
          console.log("Response headers:", [...response.headers.entries()]);

          if (response.ok) {
            const result = await response.json();
            showResult(
              "creationResult",
              `‚úÖ Product created successfully!\nResponse: ${JSON.stringify(
                result,
                null,
                2
              )}`,
              "success"
            );
          } else {
            const errorText = await response.text();
            showResult(
              "creationResult",
              `‚ùå Product creation failed (${response.status}):\n${errorText}`,
              "error"
            );
          }
        } catch (e) {
          showResult(
            "creationResult",
            "‚ùå Network error: " + e.message,
            "error"
          );
        }
      }

      async function checkDatabase() {
        try {
          showResult("databaseResult", "üîç Checking database...", "info");

          const response = await fetch("/seller/debug/check_recent_products", {
            method: "GET",
            headers: {
              "X-Requested-With": "XMLHttpRequest",
            },
          });

          if (response.ok) {
            const result = await response.json();
            showResult(
              "databaseResult",
              `üìä Recent products:\n${JSON.stringify(result, null, 2)}`,
              "info"
            );
          } else {
            const errorText = await response.text();
            showResult(
              "databaseResult",
              `‚ùå Database check failed (${response.status}):\n${errorText}`,
              "error"
            );
          }
        } catch (e) {
          showResult(
            "databaseResult",
            "‚ùå Error checking database: " + e.message,
            "error"
          );
        }
      }

      function showResult(elementId, message, type) {
        const element = document.getElementById(elementId);
        element.className = `result ${type}`;

        if (message.includes("\n") || message.includes("{")) {
          element.innerHTML = `<pre>${message}</pre>`;
        } else {
          element.textContent = message;
        }
      }

      // Auto-setup session storage on page load for convenience
      window.addEventListener("load", () => {
        console.log("Test page loaded");
        setupSessionStorage();
      });
    </script>
  </body>
</html>
