{% extends 'seller/base_seller.html' %} {% block title %}Product Management -
Dione Ecommerce{% endblock %} {% block extra_css %}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/seller_styles/seller_product_management.css') }}?v={{ range(1, 10000) | random }}"
/>
{% endblock %} {% block content %}
<script>
  // Provide server products to client JS in a safe JSON form
  window.__SELLER_PRODUCTS__ = [
    {% for p in products %}
      {{ p.to_dict() | tojson }}{% if not loop.last %},{% endif %}
    {% endfor %}
  ];
</script>
<!-- Wrapper div with product-management class for consistent styling -->
<div class="product-management">
  <div class="page-header">
    <div class="page-header-left-product">
      <h1>Product Management</h1>
      <p class="page-subtext">Manage your product listings.</p>
    </div>
  </div>

  <!-- stats -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon blue"><i data-lucide="layers"></i></div>
      <div class="stat-content">
        <span class="stat-label">Total Products</span>
        <h3 class="stat-value">{{ products|length if products else 0 }}</h3>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon orange"><i data-lucide="alert-circle"></i></div>
      <div class="stat-content">
        <span class="stat-label">Out of Stock</span>
        <h3 class="stat-value">
          {{ products|selectattr('total_stock',
          'defined')|selectattr('total_stock', 'equalto', 0)|list|length if
          products else 0 }}
        </h3>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon green"><i data-lucide="check-circle"></i></div>
      <div class="stat-content">
        <span class="stat-label">Active Listings</span>
        <h3 class="stat-value">
          {% set active_products = [] %} {% if products %} {% for p in products
          %} {% if p.status == 'active' and p.total_stock is defined and
          p.total_stock > 0 %} {% set _ = active_products.append(p) %} {% endif
          %} {% endfor %} {% endif %} {{ active_products|length }}
        </h3>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card-header">
      <!-- Nav tabs: All / Out of Stock / Active -->
      <nav class="seller-nav-tabs" role="tablist" aria-label="Product views">
        <button
          class="tab active"
          data-status=""
          id="tabAll"
          aria-selected="true"
          role="tab"
        >
          <i data-lucide="layers"></i>
          <span class="tab-label">All Products</span>
          <span class="tab-count" id="countAll">0</span>
        </button>

        <button
          class="tab"
          data-status="out-of-stock"
          id="tabOut"
          aria-selected="false"
          role="tab"
        >
          <i data-lucide="archive"></i>
          <span class="tab-label">Out of stock</span>
          <span class="tab-count" id="countOut">0</span>
        </button>

        <button
          class="tab"
          data-status="active"
          id="tabActive"
          aria-selected="false"
          role="tab"
        >
          <i data-lucide="check-circle"></i>
          <span class="tab-label">Active listings</span>
          <span class="tab-count" id="countActive">0</span>
        </button>
        <!-- sliding underline -->
        <div class="tabs-underline" aria-hidden="true"></div>
      </nav>
    </div>

    <div class="products-list card-body">
      <div class="product-controls">
        <div class="search-box">
          <input
            type="text"
            id="productSearch"
            placeholder="Search products, SKU or ID"
          />
        </div>
        <div class="filter-group">
          <select id="filterCategory">
            <option value="">All Categories</option>
            {% for c in products|map(attribute='category')|unique %}
            <option value="{{ c }}">{{ c }}</option>
            {% endfor %}
          </select>
          <select id="filterStatus">
            <option value="">All Statuses</option>
            <option value="active">Active</option>
            <option value="inactive">Inactive</option>
            <option value="out-of-stock">Out of Stock</option>
          </select>
        </div>
        <button class="btn-primary" id="addProductBtn">
          <i data-lucide="plus"></i><span>Add Product</span>
        </button>
      </div>
      <div id="bulkActions" class="bulk-actions" style="display: none">
        <button class="btn-secondary" id="bulkRestock">Restock Selected</button>
        <button class="btn-secondary" id="bulkArchive">Archive Selected</button>
        <button class="btn-secondary" id="bulkEdit">Bulk Edit</button>
      </div>
      <div class="product-table-container">
        <table class="product-table">
          <colgroup>
            <col style="width: 40px" />
            <col style="width: 25%" />
            <col style="width: 13%" />
            <col style="width: 13%" />
            <col style="width: 11%" />
            <col style="width: 11%" />
            <col style="width: 13%" />
            <col style="width: 15%" />
          </colgroup>
          <thead>
            <tr>
              <th class="col-center" style="width: 40px">
                <input type="checkbox" id="selectAll" />
              </th>
              <th class="col-left">Product</th>
              <th class="col-center">Category</th>
              <th class="col-center">Sub-Category</th>
              <th class="col-center">Price</th>
              <th class="col-center">Stock</th>
              <th class="col-center">Status</th>
              <th class="col-center">Actions</th>
            </tr>
          </thead>
          <tbody id="productTableBody">
            {% for p in products %}
            <tr data-id="{{ p.id }}">
              <td class="col-center">
                <input
                  type="checkbox"
                  class="row-select"
                  data-id="{{ p.id }}"
                />
              </td>
              <td class="col-left">
                <div class="product-info">
                  <img
                    src="{{ p.primary_image if p.primary_image else url_for('static', filename='image/banner.png') }}"
                    class="product-image"
                    alt="{{ p.name }}"
                  />
                  <span class="product-name">{{ p.name }}</span>
                </div>
              </td>
              <td class="col-center">{{ p.category }}</td>
              <td class="col-center">
                {{ p.subcategory if p.subcategory else '—' }}
              </td>
              <td class="col-center">₱{{ '%.2f'|format(p.price or 0) }}</td>
              <td class="col-center">
                {{ p.total_stock if p.total_stock is defined else '—' }}
              </td>
              <td class="col-center">
                {% set status_text = 'Active' if (p.total_stock and
                p.total_stock > 0) else 'Not Active' %} {% set status_class =
                'active' if (p.total_stock and p.total_stock > 0) else
                'inactive' %}
                <span class="status-badge status-{{ status_class }}"
                  >{{ status_text }}</span
                >
              </td>
              <td class="col-center">
                <div class="action-buttons">
                  <button
                    class="btn-icon open-variants"
                    data-id="{{ p.id }}"
                    title="Manage variant stocks"
                  >
                    <i data-lucide="layers"></i>
                  </button>
                  <button
                    class="btn-icon edit-product"
                    data-id="{{ p.id }}"
                    title="Edit product details"
                  >
                    <i data-lucide="edit"></i><span>Edit</span>
                  </button>
                  <button
                    class="btn-icon delete-product"
                    data-id="{{ p.id }}"
                    title="Delete product"
                    aria-label="Delete {{ p.name }}"
                  >
                    <i data-lucide="trash-2"></i>
                  </button>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% include 'seller/partials/_tableFooter.html' %}
      </div>
    </div>
  </div>
  <!-- Enhanced Product Edit Modal -->
  <div class="modal" id="productDetailModal">
    <div class="modal-content edit-product-modal">
      <div class="modal-header">
        <div class="modal-header-content">
          <div class="modal-icon">
            <i data-lucide="edit-3"></i>
          </div>
          <div class="modal-title-section">
            <h2 class="modal-title">Edit Product</h2>
            <p class="modal-subtitle" id="editModalProductName">Product Name</p>
          </div>
        </div>
        <button class="close-btn" id="closeProductDetailModal">
          <i data-lucide="x"></i>
        </button>
      </div>
      
      <div class="modal-body">
        <form id="editProductForm" class="edit-product-form">
          <!-- Tab Navigation -->
          <div class="edit-tabs">
            <button type="button" class="edit-tab active" data-tab="basic">
              <i data-lucide="info"></i>
              <span>Basic Info</span>
            </button>
            <button type="button" class="edit-tab" data-tab="media">
              <i data-lucide="image"></i>
              <span>Photos</span>
            </button>
            <button type="button" class="edit-tab" data-tab="pricing">
              <i data-lucide="dollar-sign"></i>
              <span>Pricing</span>
            </button>
            <button type="button" class="edit-tab" data-tab="details">
              <i data-lucide="file-text"></i>
              <span>Details</span>
            </button>
            <button type="button" class="edit-tab" data-tab="variants">
              <i data-lucide="layers"></i>
              <span>Variants</span>
            </button>
          </div>

          <!-- Tab Content -->
          <div class="edit-tab-content">
            
            <!-- Basic Info Tab -->
            <div class="tab-pane active" id="tab-basic">
              <div class="form-section">
                <h3 class="section-title">
                  <i data-lucide="info"></i>
                  Basic Information
                </h3>
                
                <div class="form-grid">
                  <div class="form-group full-width">
                    <label for="editProductName">Product Name *</label>
                    <input type="text" id="editProductName" name="name" class="form-input" required />
                  </div>

                  <div class="form-group">
                    <label for="editProductCategory">Category *</label>
                    <select id="editProductCategory" name="category" class="form-select" required>
                      <option value="">Select Category</option>
                      <option value="clothing">Clothing</option>
                      <option value="shoes">Shoes</option>
                      <option value="accessories">Accessories</option>
                    </select>
                  </div>

                  <div class="form-group">
                    <label for="editProductSubcategory">Subcategory</label>
                    <select id="editProductSubcategory" name="subcategory" class="form-select">
                      <option value="">Select Subcategory</option>
                    </select>
                  </div>

                  <div class="form-group full-width">
                    <label for="editProductDescription">Description *</label>
                    <textarea id="editProductDescription" name="description" class="form-textarea" rows="4" required></textarea>
                  </div>

                  <div class="form-group">
                    <label for="editProductStatus">Status</label>
                    <select id="editProductStatus" name="status" class="form-select">
                      <option value="active">Active</option>
                      <option value="inactive">Inactive</option>
                      <option value="draft">Draft</option>
                    </select>
                  </div>

                  <div class="form-group">
                    <label for="editProductSKU">Base SKU</label>
                    <input type="text" id="editProductSKU" name="base_sku" class="form-input" />
                  </div>
                </div>
              </div>
            </div>

            <!-- Media Tab -->
            <div class="tab-pane" id="tab-media">
              <div class="form-section">
                <h3 class="section-title">
                  <i data-lucide="image"></i>
                  Product Photos
                </h3>
                
                <div class="media-grid">
                  <div class="media-upload-section">
                    <label>Primary Image *</label>
                    <div class="image-upload-container">
                      <div class="image-preview" id="primaryImagePreview">
                        <img id="primaryImageDisplay" src="" alt="Primary Image" style="display: none;" />
                        <div class="upload-placeholder">
                          <i data-lucide="camera"></i>
                          <span>Upload Primary Image</span>
                        </div>
                      </div>
                      <input type="file" id="editPrimaryImage" name="primary_image" accept="image/*" style="display: none;" />
                      <button type="button" class="btn-upload" onclick="document.getElementById('editPrimaryImage').click()">
                        <i data-lucide="upload"></i>
                        Choose Image
                      </button>
                    </div>
                  </div>

                  <div class="media-upload-section">
                    <label>Secondary Image</label>
                    <div class="image-upload-container">
                      <div class="image-preview" id="secondaryImagePreview">
                        <img id="secondaryImageDisplay" src="" alt="Secondary Image" style="display: none;" />
                        <div class="upload-placeholder">
                          <i data-lucide="image"></i>
                          <span>Upload Secondary Image</span>
                        </div>
                      </div>
                      <input type="file" id="editSecondaryImage" name="secondary_image" accept="image/*" style="display: none;" />
                      <button type="button" class="btn-upload" onclick="document.getElementById('editSecondaryImage').click()">
                        <i data-lucide="upload"></i>
                        Choose Image
                      </button>
                    </div>
                  </div>
                </div>

                <div class="size-guide-section">
                  <label>Size Guide Photos</label>
                  <p class="help-text">Upload up to 5 size guide photos</p>
                  <div class="size-guide-grid" id="sizeGuideGrid">
                    <!-- Size guide uploads will be added dynamically -->
                  </div>
                  <button type="button" class="btn-add-size-guide" id="addSizeGuideBtn">
                    <i data-lucide="plus"></i>
                    Add Size Guide Photo
                  </button>
                </div>
              </div>
            </div>

            <!-- Pricing Tab -->
            <div class="tab-pane" id="tab-pricing">
              <div class="form-section">
                <h3 class="section-title">
                  <i data-lucide="dollar-sign"></i>
                  Pricing Information
                </h3>
                
                <div class="form-grid">
                  <div class="form-group">
                    <label for="editProductPrice">Base Price *</label>
                    <div class="input-with-prefix">
                      <span class="prefix">₱</span>
                      <input type="number" id="editProductPrice" name="price" class="form-input" step="0.01" required />
                    </div>
                  </div>

                  <div class="form-group">
                    <label for="editComparePrice">Compare At Price</label>
                    <div class="input-with-prefix">
                      <span class="prefix">₱</span>
                      <input type="number" id="editComparePrice" name="compare_at_price" class="form-input" step="0.01" />
                    </div>
                  </div>

                  <div class="form-group">
                    <label for="editDiscountType">Discount Type</label>
                    <select id="editDiscountType" name="discount_type" class="form-select">
                      <option value="">No Discount</option>
                      <option value="percentage">Percentage</option>
                      <option value="fixed">Fixed Amount</option>
                    </select>
                  </div>

                  <div class="form-group">
                    <label for="editDiscountValue">Discount Value</label>
                    <input type="number" id="editDiscountValue" name="discount_value" class="form-input" step="0.01" />
                  </div>

                  <div class="form-group">
                    <label for="editVoucherType">Voucher Type</label>
                    <select id="editVoucherType" name="voucher_type" class="form-select">
                      <option value="">No Voucher</option>
                      <option value="free_shipping">Free Shipping</option>
                      <option value="buy_one_get_one">Buy One Get One</option>
                      <option value="bundle_discount">Bundle Discount</option>
                    </select>
                  </div>

                  <div class="form-group">
                    <label for="editLowStockThreshold">Low Stock Threshold</label>
                    <input type="number" id="editLowStockThreshold" name="low_stock_threshold" class="form-input" min="0" />
                  </div>
                </div>
              </div>
            </div>

            <!-- Details Tab -->
            <div class="tab-pane" id="tab-details">
              <div class="form-section">
                <h3 class="section-title">
                  <i data-lucide="file-text"></i>
                  Product Details
                </h3>
                
                <div class="form-grid">
                  <div class="form-group full-width">
                    <label for="editProductMaterials">Materials & Care *</label>
                    <textarea id="editProductMaterials" name="materials" class="form-textarea" rows="4" 
                              placeholder="e.g., 100% Cotton&#10;Machine wash cold&#10;Tumble dry low" required></textarea>
                  </div>

                  <div class="form-group full-width">
                    <label for="editProductDetailsFit">Details & Fit *</label>
                    <textarea id="editProductDetailsFit" name="details_fit" class="form-textarea" rows="4" 
                              placeholder="e.g., Relaxed fit&#10;Crew neckline&#10;Short sleeves&#10;Length: 26 inches" required></textarea>
                  </div>
                </div>

                <div class="certifications-section">
                  <label>Certifications (Sustainability)</label>
                  <p class="help-text">Upload up to 5 certification photos</p>
                  <div class="certifications-grid" id="certificationsGrid">
                    <!-- Certification uploads will be added dynamically -->
                  </div>
                  <button type="button" class="btn-add-certification" id="addCertificationBtn">
                    <i data-lucide="plus"></i>
                    Add Certification Photo
                  </button>
                </div>
              </div>
            </div>

            <!-- Variants Tab -->
            <div class="tab-pane" id="tab-variants">
              <div class="form-section">
                <h3 class="section-title">
                  <i data-lucide="layers"></i>
                  Product Variants & Stock
                </h3>
                
                <div class="variants-summary">
                  <div class="summary-card">
                    <div class="summary-icon">
                      <i data-lucide="layers"></i>
                    </div>
                    <div class="summary-content">
                      <span class="summary-label">Total Variants</span>
                      <span class="summary-value" id="editTotalVariants">0</span>
                    </div>
                  </div>
                  <div class="summary-card">
                    <div class="summary-icon">
                      <i data-lucide="package"></i>
                    </div>
                    <div class="summary-content">
                      <span class="summary-label">Total Stock</span>
                      <span class="summary-value" id="editTotalStock">0</span>
                    </div>
                  </div>
                </div>

                <div class="variants-actions">
                  <button type="button" class="btn-primary" id="editAddVariantBtn">
                    <i data-lucide="plus"></i>
                    Add Variant
                  </button>
                  <button type="button" class="btn-secondary" id="editManageStockBtn">
                    <i data-lucide="settings"></i>
                    Manage Stock
                  </button>
                </div>

                <div class="variants-list" id="editVariantsList">
                  <!-- Variants will be loaded dynamically -->
                </div>
              </div>
            </div>

          </div>
        </form>
      </div>
      
      <div class="modal-footer">
        <button type="button" class="btn-secondary" id="closeProductDetailModalFooter">
          <i data-lucide="x"></i>
          Cancel
        </button>
        <button type="button" class="btn-primary" id="saveProductDetails">
          <i data-lucide="save"></i>
          Save Changes
        </button>
      </div>
    </div>
  </div>

  <!-- Variant Stocks Modal -->
  <div class="modal" id="variantStockModal">
    <div class="modal-content variant-stock-modal">
      <div class="modal-header">
        <div class="modal-header-content">
          <div class="modal-icon">
            <i data-lucide="layers"></i>
          </div>
          <div class="modal-title-section">
            <h2 class="modal-title">Stock Management</h2>
            <p class="modal-subtitle" id="variantModalProductName">
              Product Name
            </p>
          </div>
        </div>
        <button class="close-btn" id="closeVariantStockModal">
          <i data-lucide="x"></i>
        </button>
      </div>
      <div class="modal-body">
        <div class="variant-stock-container">
          <div class="stock-summary">
            <div class="summary-card">
              <div class="summary-icon">
                <i data-lucide="layers"></i>
              </div>
              <div class="summary-content">
                <span class="summary-label">Total Variants</span>
                <span class="summary-value" id="totalVariantsCount">0</span>
              </div>
            </div>
            <div class="summary-card">
              <div class="summary-icon">
                <i data-lucide="layers"></i>
              </div>
              <div class="summary-content">
                <span class="summary-label">Total Stock</span>
                <span class="summary-value" id="totalStockCount">0</span>
              </div>
            </div>
          </div>
          <div class="variant-list-container">
            <div class="variant-list-header">
              <h3>Product Variants</h3>
              <p>Manage stock levels and sizes for each variant</p>
            </div>
            <div id="variantStockList" class="variant-stock-list"></div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button
          class="btn-secondary close-btn"
          id="closeVariantStockModalFooter"
        >
          <i data-lucide="x"></i>
          Cancel
        </button>
        <button class="btn-primary" id="saveVariantStocks">
          <i data-lucide="save"></i>
          Save Changes
        </button>
      </div>
    </div>
  </div>

  <!-- Size Selection Modal -->
  <div id="sizeSelectModal" class="modal">
    <div class="modal-content size-modal-content">
      <div class="modal-header">
        <div class="modal-header-content">
          <div class="modal-icon">
            <i data-lucide="ruler"></i>
          </div>
          <div class="modal-title-section">
            <h2 class="modal-title">Edit Sizes & Stock</h2>
            <p class="modal-subtitle" id="sizeModalVariantName">Variant Name</p>
          </div>
        </div>
        <button class="close-btn" id="sizeModalClose">
          <i data-lucide="x"></i>
        </button>
      </div>
      <div class="modal-body">
        <div class="size-modal-note">
          Select sizes and set stock quantities for this variant
        </div>
        <div id="sizeOptionsContainer" class="size-options-area"></div>
      </div>
      <div class="modal-footer">
        <button
          type="button"
          id="sizeModalCancel"
          class="btn-secondary"
          title="Cancel changes"
        >
          <i data-lucide="x"></i>
          Cancel
        </button>
        <button
          type="button"
          id="sizeModalSave"
          class="btn-primary"
          title="Save stock changes"
        >
          <i data-lucide="save"></i>
          Save Changes
        </button>
      </div>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div class="modal" id="deleteConfirmModal">
    <div class="modal-content" style="max-width: 400px">
      <div class="modal-header">
        <h2 class="modal-title">Confirm Delete</h2>
        <button class="close-btn" id="closeDeleteModal">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
            <path
              d="M15 5L5 15M5 5L15 15"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <div class="delete-warning">
          <i
            data-lucide="alert-triangle"
            style="color: #f59e0b; width: 48px; height: 48px"
          ></i>
          <p>Are you sure you want to delete this product?</p>
          <p
            class="product-name-to-delete"
            style="font-weight: 600; margin: 8px 0"
          ></p>
          <p style="color: #6b7280; font-size: 14px">
            This action cannot be undone.
          </p>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" id="cancelDelete">
          Cancel
        </button>
        <button type="button" class="btn btn-danger" id="confirmDelete">
          <i data-lucide="trash-2"></i> Delete Product
        </button>
      </div>
    </div>
  </div>

  {% endblock %} {% block extra_js %}
  <script src="{{ url_for('static', filename='js/seller_scripts/seller_product_management.js') }}?v={{ range(1, 10000) | random }}"></script>

  {% endblock %}
</div>
