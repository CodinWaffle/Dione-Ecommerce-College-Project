{% extends 'seller/base_seller.html' %} {% block title %}Product Management -
Dione Ecommerce{% endblock %} {% block extra_css %}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/seller_styles/seller_product_management.css') }}?v={{ range(1, 10000) | random }}"
/>
{% endblock %} {% block content %}
<script>
  // Provide server products to client JS in a safe JSON form
  window.__SELLER_PRODUCTS__ = [
    {% for p in products %}
      {{ p.to_dict() | tojson }}{% if not loop.last %},{% endif %}
    {% endfor %}
  ];
</script>
<!-- Wrapper div with product-management class for consistent styling -->
<div class="product-management">
  <div class="page-header">
    <div class="page-header-left-product">
      <h1>Product Management</h1>
      <p class="page-subtext">Manage your product listings.</p>
    </div>
  </div>

  <!-- stats -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon blue"><i data-lucide="layers"></i></div>
      <div class="stat-content">
        <span class="stat-label">Total Products</span>
        <h3 class="stat-value">{{ products|length if products else 0 }}</h3>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon orange"><i data-lucide="alert-circle"></i></div>
      <div class="stat-content">
        <span class="stat-label">Out of Stock</span>
        <h3 class="stat-value">
          {{ products|selectattr('total_stock',
          'defined')|selectattr('total_stock', 'equalto', 0)|list|length if
          products else 0 }}
        </h3>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon green"><i data-lucide="check-circle"></i></div>
      <div class="stat-content">
        <span class="stat-label">Active Listings</span>
        <h3 class="stat-value">
          {{ products|selectattr('status', 'equalto', 'active')|list|length if
          products else 0 }}
        </h3>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card-header">
      <!-- Nav tabs: All / Out of Stock / Active -->
      <nav class="seller-nav-tabs" role="tablist" aria-label="Product views">
        <button
          class="tab active"
          data-status=""
          id="tabAll"
          aria-selected="true"
          role="tab"
        >
          <i data-lucide="layers"></i>
          <span class="tab-label">All Products</span>
          <span class="tab-count" id="countAll">0</span>
        </button>

        <button
          class="tab"
          data-status="out-of-stock"
          id="tabOut"
          aria-selected="false"
          role="tab"
        >
          <i data-lucide="archive"></i>
          <span class="tab-label">Out of stock</span>
          <span class="tab-count" id="countOut">0</span>
        </button>

        <button
          class="tab"
          data-status="active"
          id="tabActive"
          aria-selected="false"
          role="tab"
        >
          <i data-lucide="check-circle"></i>
          <span class="tab-label">Active listings</span>
          <span class="tab-count" id="countActive">0</span>
        </button>
        <!-- sliding underline -->
        <div class="tabs-underline" aria-hidden="true"></div>
      </nav>
    </div>

    <div class="products-list card-body">
      <div class="product-controls">
        <div class="search-box">
          <input
            type="text"
            id="productSearch"
            placeholder="Search products, SKU or ID"
          />
        </div>
        <div class="filter-group">
          <select id="filterCategory">
            <option value="">All Categories</option>
            {% for c in products|map(attribute='category')|unique %}
            <option value="{{ c }}">{{ c }}</option>
            {% endfor %}
          </select>
          <select id="filterStatus">
            <option value="">All Statuses</option>
            <option value="active">Active</option>
            <option value="inactive">Inactive</option>
            <option value="out-of-stock">Out of Stock</option>
          </select>
        </div>
        <button class="btn-primary" id="addProductBtn">
          <i data-lucide="plus"></i><span>Add Product</span>
        </button>
      </div>
      <div id="bulkActions" class="bulk-actions" style="display: none">
        <button class="btn-secondary" id="bulkRestock">Restock Selected</button>
        <button class="btn-secondary" id="bulkArchive">Archive Selected</button>
        <button class="btn-secondary" id="bulkEdit">Bulk Edit</button>
      </div>
      <div class="product-table-container">
        <table class="product-table">
          <colgroup>
            <col style="width: 40px" />
            <col style="width: 30%" />
            <col style="width: 12%" />
            <col style="width: 12%" />
            <col style="width: 10%" />
            <col style="width: 10%" />
            <col style="width: 12%" />
            <col style="width: 14%" />
          </colgroup>
          <thead>
            <tr>
              <th style="width: 40px">
                <input type="checkbox" id="selectAll" />
              </th>
              <th>Product</th>
              <th class="col-right">Category</th>
              <th class="col-right">Sub-Category</th>
              <th class="col-right">Price</th>
              <th class="col-right">Stock</th>
              <th class="col-right">Status</th>
              <th class="col-right">Actions</th>
            </tr>
          </thead>
          <tbody id="productTableBody">
            {% for p in products %}
            <tr data-id="{{ p.id }}">
              <td>
                <input
                  type="checkbox"
                  class="row-select"
                  data-id="{{ p.id }}"
                />
              </td>
              <td>
                <div class="product-info">
                  <img
                    src="{{ p.primary_image if p.primary_image else url_for('static', filename='image/banner.png') }}"
                    class="product-image"
                    alt="{{ p.name }}"
                  />
                  <span class="product-name">{{ p.name }}</span>
                </div>
              </td>
              <td class="col-right">{{ p.category }}</td>
              <td class="col-right">
                {{ p.subcategory if p.subcategory else '—' }}
              </td>
              <td class="col-right">${{ '%.2f'|format(p.price or 0) }}</td>
              <td class="col-right">
                {{ p.total_stock if p.total_stock is defined else '—' }}
              </td>
              <td class="col-right">
                <span class="status-badge status-{{ p.status }}"
                  >{{ p.status }}</span
                >
              </td>
              <td class="col-right">
                <div class="action-buttons">
                  <button class="btn-icon edit-product" data-id="{{ p.id }}">
                    <i data-lucide="edit"></i><span>Edit</span>
                  </button>
                  <button
                    class="btn-icon delete-product"
                    data-id="{{ p.id }}"
                    aria-label="Delete {{ p.name }}"
                  >
                    <i data-lucide="trash-2"></i>
                  </button>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% include 'seller/partials/_tableFooter.html' %}
      </div>
    </div>
  </div>
  <!-- Product Detail Modal -->
  <div class="modal" id="productDetailModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">Product Details</h2>
        <button class="close-btn" id="closeProductDetailModal">
          <svg
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <div class="product-detail">
          <div class="product-image-column">
            <div class="product-image-box">
              <img
                src=""
                alt="Product Image"
                id="modalProductImage"
                class="product-image-lg"
              />
            </div>
            <div class="image-actions">
              <label
                for="modalProductImageInput"
                class="btn btn-secondary btn-ghost"
              >
                <i data-lucide="image"></i>
                <span>Change Image</span>
              </label>
              <input
                type="file"
                id="modalProductImageInput"
                accept="image/*"
                style="display: none"
              />
            </div>
          </div>
          <div class="product-main-column">
            <div class="form-row">
              <label for="modalProductName">Name</label>
              <input type="text" id="modalProductName" class="modal-input" />
            </div>

            <div class="form-row form-row-split">
              <div>
                <label for="modalProductCategory">Category</label>
                <input
                  type="text"
                  id="modalProductCategory"
                  class="modal-input"
                  placeholder="Category"
                />
              </div>
              <div>
                <label for="modalProductSubcategory">Subcategory</label>
                <input
                  type="text"
                  id="modalProductSubcategory"
                  class="modal-input"
                  placeholder="Subcategory"
                />
              </div>
            </div>

            <div class="form-row form-row-split">
              <div>
                <label for="modalProductPrice">Price</label>
                <input
                  type="number"
                  step="0.01"
                  id="modalProductPrice"
                  class="modal-input"
                />
              </div>
              <div>
                <label for="modalProductStock">Total Stock</label>
                <input
                  type="number"
                  id="modalProductStock"
                  class="modal-input"
                />
              </div>
            </div>

            <div class="form-row">
              <label for="modalProductDescription">Description</label>
              <textarea
                id="modalProductDescription"
                class="modal-textarea"
                rows="5"
              ></textarea>
            </div>
          </div>

          <aside class="product-side-column">
            <section class="side-section">
              <h4 class="side-title">Variants</h4>
              <div id="modalProductVariants" class="side-content"></div>
            </section>
            <section class="side-section">
              <h4 class="side-title">Attributes</h4>
              <div id="modalProductAttributes" class="side-content"></div>
            </section>
          </aside>
        </div>
      </div>
      <div
        class="modal-footer"
        style="
          display: flex;
          gap: 8px;
          justify-content: flex-end;
          padding: 12px 20px;
          border-top: 1px solid #eee;
        "
      >
        <button
          class="btn-secondary close-btn"
          id="closeProductDetailModalFooter"
        >
          Close
        </button>
        <button class="btn-primary" id="saveProductDetails">
          Save Changes
        </button>
      </div>
    </div>
  </div>

  <!-- Variant Stocks Modal -->
  <div class="modal" id="variantStockModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">Manage Variant Stocks</h2>
        <button class="close-btn" id="closeVariantStockModal">
          <svg
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <div id="variantStockContainer">
          <div style="margin-bottom: 8px">
            <strong id="variantModalProductName">-</strong>
          </div>
          <div
            id="variantStockList"
            style="display: flex; flex-direction: column; gap: 8px"
          ></div>
        </div>
      </div>
      <div
        class="modal-footer"
        style="
          display: flex;
          gap: 8px;
          justify-content: flex-end;
          padding: 12px 20px;
          border-top: 1px solid #eee;
        "
      >
        <button
          class="btn-secondary close-btn"
          id="closeVariantStockModalFooter"
        >
          Close
        </button>
        <button class="btn-primary" id="saveVariantStocks">Save Stocks</button>
      </div>
    </div>
  </div>

  {% endblock %} {% block extra_js %}
  <script src="{{ url_for('static', filename='js/seller_scripts/seller_product_management.js') }}?v={{ range(1, 10000) | random }}"></script>

  {% endblock %}
</div>
