{% set active_page = 'products' %} {% extends 'seller/base_seller.html' %} {%
block title %}Product Preview{% endblock %} {% block extra_css %} <link
rel="stylesheet" href="{{ url_for('static',
filename='css/seller_styles/add_product_preview.css') }}" / >
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/seller_styles/progress_bar.css') }}"
/>
{% endblock %} {% block content %} {% set progress_step = 4 %} {% include
'seller/partials/_progress_bar.html' %} {% if product_data %}
<script>
  // If server provided product_data (from session), mirror it into localStorage
  (function () {
    try {
      const pd = {{ product_data | tojson | safe }} || {};
      const step1 = pd.step1 || {};
      const step2 = pd.step2 || {};
      const step3 = pd.step3 || {};

      // map step1 to productForm expected keys
      const productForm = {
        productName: step1.productName || '',
        price: step1.price || '',
        discountPercentage: step1.discountPercentage || '',
        discountType: step1.discountType || '',
        voucherType: step1.voucherType || '',
        category: step1.category || '',
        subcategory: step1.subcategory || '',
        subitem: step1.subitem || [],
        primaryImage: step1.primaryImage || '',
        secondaryImage: step1.secondaryImage || ''
      };
      localStorage.setItem('productForm', JSON.stringify(productForm));
      localStorage.setItem('productDescriptionForm', JSON.stringify(step2));
      localStorage.setItem('productStocksForm', JSON.stringify(step3));
      // flag to indicate server-backed preview
      window.__SERVER_PREVIEW = true;
    } catch (err) {
      console.warn('Failed to mirror server product_data to localStorage', err);
    }
  })();
</script>
{% endif %}
<div class="container-fluid preview-page">
  <div class="preview-section">
    <div class="page-header">
      <div class="page-header-left">
        <h2>Product Preview</h2>
        <p class="page-subtext">Summary of your product details</p>
      </div>
    </div>

    <!-- Basic Info Preview -->
    <div class="preview-group">
      <h3>Basic Information</h3>
      <div class="preview-content" id="basicInfoPreview">
        <div class="preview-item">
          <label>Product Name:</label>
          <span id="previewProductName">-</span>
        </div>
        <div class="preview-item">
          <label>Price:</label>
          <span id="previewPrice">-</span>
        </div>
        <div class="preview-item">
          <label>Category:</label>
          <span id="previewCategory">-</span>
        </div>
        <div class="preview-item">
          <label>Subcategory:</label>
          <span id="previewSubCategory">-</span>
        </div>
        <div class="preview-item">
          <label>Discount Type:</label>
          <span id="previewDiscountType">-</span>
        </div>
        <div class="preview-item">
          <label>Sub-Items:</label>
          <span id="previewSubItems">-</span>
        </div>
        <div class="preview-item">
          <label>Discount Percentage:</label>
          <span id="previewDiscountPercent">-</span>
        </div>
        <div class="preview-item">
          <label>Model Information:</label>
          <span id="previewModelInfo">-</span>
        </div>
        <div class="preview-item">
          <label>Voucher Type:</label>
          <span id="previewVoucherType">-</span>
        </div>
        <div class="preview-item">
          <label>Product Filters Applied:</label>
          <span id="previewProductFilters">-</span>
        </div>
        <div class="preview-images">
          <label><strong>Product Photos:</strong></label>
          <div id="previewImages" class="image-grid">
            <!-- Images will be inserted here -->
          </div>
        </div>
      </div>
    </div>

    <!-- Description Preview -->
    <div class="preview-group">
      <h3>Product Details</h3>
      <div class="preview-content" id="descriptionPreview">
        <div class="preview-item full-width">
          <label><strong>Size Guide Photos</strong></label>
          <div id="previewSizeGuide" class="image-grid">
            <!-- Size guide photos will be inserted here -->
          </div>
        </div>
        <div class="preview-item">
          <label>Description:</label>
          <p id="previewDescription">-</p>
        </div>
        <div class="preview-item">
          <label>Materials & Care:</label>
          <p id="previewMaterials">-</p>
        </div>
        <div class="preview-item">
          <label>Details & Fit:</label>
          <p id="previewDetailsFit">-</p>
        </div>
        <div class="preview-item full-width">
          <label><strong>Certifications</strong></label>
          <div id="previewCertifications" class="image-grid">
            <!-- Certification photos will be inserted here -->
          </div>
        </div>
      </div>
    </div>

    <!-- Stock Preview -->
    <div class="preview-group">
      <h3>Stock Information</h3>
      <div class="preview-content" id="stockPreview">
        <div class="preview-item">
          <label>Total Stock:</label>
          <span id="previewTotalStock">-</span>
        </div>
        <div class="preview-item full-width">
          <label>Variants:</label>
          <div style="overflow-x: auto">
            <table
              id="previewVariantsTable"
              class="variants-table"
              style="width: 100%; border-collapse: collapse; margin-top: 0.5rem"
            >
              <thead>
                <tr
                  style="
                    border-bottom: 2px solid #e0e0e0;
                    background-color: #f5f5f5;
                  "
                >
                  <th
                    style="
                      padding: 10px;
                      text-align: left;
                      font-weight: 600;
                      color: #333;
                    "
                  >
                    Photo
                  </th>
                  <th
                    style="
                      padding: 10px;
                      text-align: left;
                      font-weight: 600;
                      color: #333;
                    "
                  >
                    SKU
                  </th>
                  <th
                    style="
                      padding: 10px;
                      text-align: left;
                      font-weight: 600;
                      color: #333;
                    "
                  >
                    Color
                  </th>
                  <th
                    style="
                      padding: 10px;
                      text-align: left;
                      font-weight: 600;
                      color: #333;
                    "
                  >
                    Size
                  </th>
                  <th
                    style="
                      padding: 10px;
                      text-align: center;
                      font-weight: 600;
                      color: #333;
                    "
                  >
                    Stock
                  </th>
                  <th
                    style="
                      padding: 10px;
                      text-align: center;
                      font-weight: 600;
                      color: #333;
                    "
                  >
                    Low Stock
                  </th>
                </tr>
              </thead>
              <tbody id="previewVariantsList">
                <tr>
                  <td
                    colspan="5"
                    style="padding: 10px; text-align: center; color: #999"
                  >
                    -
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Add Product and Back buttons at bottom of preview -->
    <div
      class="preview-navigation"
      style="
        display: flex;
        justify-content: space-between;
        gap: 1rem;
        margin-top: 2rem;
      "
    >
      <button type="button" class="btn btn-secondary" id="backBtn">
        <svg
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <line x1="19" y1="12" x2="5" y2="12"></line>
          <polyline points="12 19 5 12 12 5"></polyline>
        </svg>
        Back
      </button>
      <div class="nav-spacer"></div>
      <button type="button" class="btn btn-success" id="submitBtn">
        <svg
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <polyline points="20 6 9 17 4 12"></polyline>
        </svg>
        Add Product
      </button>
    </div>
  </div>
</div>
{% endblock %} {% block extra_js %}
<script src="{{ url_for('static', filename='js/seller_scripts/add_product_flow.js') }}"></script>
<script src="{{ url_for('static', filename='js/seller_scripts/add_product_preview.js') }}"></script>
<script src="{{ url_for('static', filename='js/seller_scripts/progress_bar.js') }}"></script>
{% endblock %}
