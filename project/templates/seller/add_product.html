{% set active_page = 'products' %} {% extends 'seller/base_seller.html' %} {%
block title %}Add New Product{% endblock %} {% block extra_css %}
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css"
/>
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/seller_styles/add_product.css') }}"
/>
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/seller_styles/progress_bar.css') }}"
/>
{% endblock %} {% block content %}
<div class="add-product-page">
  <div class="container">
    {% set progress_step = 1 %} {% include 'seller/partials/_progress_bar.html'
    %}

    <!-- Restructured: form-container now explicitly separates left (form) and right (sidebar) sections -->
    <div class="form-container">
      <!-- LEFT COLUMN: Main Product Form -->
      <form id="productForm" class="form-main">
        <!-- Main Form Section -->
        <div class="form-section">
          <div class="page-header">
            <div class="section-icon">
              <i class="ri-shopping-bag-line"></i>
            </div>
            <div class="page-header-left">
              <h2>Product Details</h2>
              <p class="page-subtext">
                Enter the essential details of your product
              </p>
            </div>
          </div>

          <div class="form-grid">
            <div class="form-group full-width">
              <label for="productName">Product Name</label>
              <input
                type="text"
                id="productName"
                name="productName"
                required
                placeholder="Enter product name"
              />
            </div>

            <!-- Product Media -->
            <div class="form-group full-width">
              <label>Product Photos</label>
              <p class="form-help-text">Upload main and secondary photos for your product. Additional photos can be added in the variation section.</p>
              
              <!-- Hidden inputs for form submission -->
              <input type="hidden" name="primaryImage" id="primaryImageField" />
              <input type="hidden" name="secondaryImage" id="secondaryImageField" />
              
              <div class="product-photo-container">
                <div class="product-photo-upload" data-photo-type="primary">
                  <input type="file" accept="image/*" class="photo-input" style="display: none;">
                  <div class="photo-placeholder">
                    <i class="ri-camera-line"></i>
                    <span>Main Photo</span>
                    <small>Click to upload</small>
                  </div>
                </div>
                
                <div class="product-photo-upload" data-photo-type="secondary">
                  <input type="file" accept="image/*" class="photo-input" style="display: none;">
                  <div class="photo-placeholder">
                    <i class="ri-image-line"></i>
                    <span>Secondary Photo</span>
                    <small>Click to upload</small>
                  </div>
                </div>
              </div>
            </div>

            <!-- Pricing Container -->
            <div class="form-container-section">
              <div class="section-header">
                <div class="section-icon">
                  <i class="ri-money-php-circle-line"></i>
                </div>
                <h3>Pricing</h3>
              </div>
              <div class="section-content">
                <div class="form-group">
                  <label for="price">Base Price</label>
                  <div class="input-with-prefix">
                    <span class="prefix">â‚±</span>
                    <input
                      type="number"
                      id="price"
                      name="price"
                      required
                      placeholder="0.00"
                      step="0.01"
                      min="0"
                    />
                  </div>
                </div>
                <div class="form-group">
                  <label for="discountPercentage">Discount Percentage</label>
                  <div class="input-with-suffix">
                    <input
                      type="number"
                      id="discountPercentage"
                      name="discountPercentage"
                      placeholder="0"
                      min="0"
                      max="100"
                    />
                    <span class="suffix">%</span>
                  </div>
                </div>
                <div class="form-group">
                  <label for="discountType">Discount Type</label>
                  <select id="discountType" name="discountType">
                    <option value="">Select discount type</option>
                    <option value="percentage">Percentage Off</option>
                    <option value="fixed">Fixed Amount</option>
                    <option value="bogo">Buy One Get One</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="voucherType">Voucher Type</label>
                  <select id="voucherType" name="voucherType">
                    <option value="">Select voucher type</option>
                    <option value="new_customer">New Customer</option>
                    <option value="seasonal">Seasonal</option>
                    <option value="clearance">Clearance</option>
                    <option value="loyalty">Loyalty Reward</option>
                  </select>
                </div>
              </div>
            </div>

            <!-- Category Container -->
            <div class="form-container-section">
              <div class="section-header">
                <i class="ri-folder-line"></i>
                <h3>Category</h3>
              </div>
              <div class="section-content">
                <div class="form-group">
                  <label for="category">Category</label>
                  <select id="category" name="category" required>
                    <option value="">Select Category</option>
                    <option value="clothing">Clothing</option>
                    <option value="shoes">Shoes</option>
                    <option value="accessories">Accessories</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="subcategory">Subcategory</label>
                  <select id="subcategory" name="subcategory" required>
                    <option value="">Select Subcategory</option>
                  </select>
                </div>
                <div
                  class="form-group full-width"
                  id="subItemsContainer"
                  style="display: none"
                >
                  <label>Sub-Items (Select multiple)</label>
                  <div class="sub-items-grid">
                    <!-- Occasionwear Sub-items -->
                    <div id="occasionwear-items" style="display: none">
                      <div class="sub-item-option">
                        <input
                          type="checkbox"
                          id="formal-dresses"
                          name="subitem"
                        />
                        <label for="formal-dresses">Formal Dresses</label>
                      </div>
                      <div class="sub-item-option">
                        <input
                          type="checkbox"
                          id="cocktail-dresses"
                          name="subitem"
                        />
                        <label for="cocktail-dresses">Cocktail Dresses</label>
                      </div>
                      <div class="sub-item-option">
                        <input
                          type="checkbox"
                          id="evening-gowns"
                          name="subitem"
                        />
                        <label for="evening-gowns">Evening Gowns</label>
                      </div>
                      <div class="sub-item-option">
                        <input
                          type="checkbox"
                          id="party-dresses"
                          name="subitem"
                        />
                        <label for="party-dresses">Party Dresses</label>
                      </div>
                      <div class="sub-item-option">
                        <input
                          type="checkbox"
                          id="wedding-dresses"
                          name="subitem"
                        />
                        <label for="wedding-dresses">Wedding Dresses</label>
                      </div>
                    </div>

                    <!-- Slippers & Comfort Wear Sub-items -->
                    <div id="slippers-items" style="display: none">
                      <div class="sub-item-option">
                        <input
                          type="checkbox"
                          id="house-slippers"
                          name="subitem"
                        />
                        <label for="house-slippers">House Slippers</label>
                      </div>
                      <div class="sub-item-option">
                        <input
                          type="checkbox"
                          id="slide-sandals"
                          name="subitem"
                        />
                        <label for="slide-sandals">Slide Sandals</label>
                      </div>
                      <div class="sub-item-option">
                        <input type="checkbox" id="moccasins" name="subitem" />
                        <label for="moccasins">Moccasins</label>
                      </div>
                      <div class="sub-item-option">
                        <input
                          type="checkbox"
                          id="comfort-clogs"
                          name="subitem"
                        />
                        <label for="comfort-clogs">Comfort Clogs</label>
                      </div>
                    </div>

                    <!-- Occasion/Dress Shoes Sub-items -->
                    <div id="dress-shoes-items" style="display: none">
                      <div class="sub-item-option">
                        <input type="checkbox" id="pumps" name="subitem" />
                        <label for="pumps">Pumps</label>
                      </div>
                      <div class="sub-item-option">
                        <input type="checkbox" id="stilettos" name="subitem" />
                        <label for="stilettos">Stilettos</label>
                      </div>
                      <div class="sub-item-option">
                        <input
                          type="checkbox"
                          id="dress-sandals"
                          name="subitem"
                        />
                        <label for="dress-sandals">Dress Sandals</label>
                      </div>
                      <div class="sub-item-option">
                        <input
                          type="checkbox"
                          id="wedding-shoes"
                          name="subitem"
                        />
                        <label for="wedding-shoes">Wedding Shoes</label>
                      </div>
                      <div class="sub-item-option">
                        <input
                          type="checkbox"
                          id="kitten-heels"
                          name="subitem"
                        />
                        <label for="kitten-heels">Kitten Heels</label>
                      </div>
                    </div>

                    <!-- Others (Accessories) Sub-items -->
                    <div id="others-accessories-items" style="display: none">
                      <div class="sub-item-option">
                        <input
                          type="checkbox"
                          id="hair-accessories"
                          name="subitem"
                        />
                        <label for="hair-accessories">Hair Accessories</label>
                      </div>
                      <div class="sub-item-option">
                        <input
                          type="checkbox"
                          id="phone-cases"
                          name="subitem"
                        />
                        <label for="phone-cases">Phone Cases</label>
                      </div>
                      <div class="sub-item-option">
                        <input type="checkbox" id="keychains" name="subitem" />
                        <label for="keychains">Keychains</label>
                      </div>
                      <div class="sub-item-option">
                        <input
                          type="checkbox"
                          id="cosmetic-bags"
                          name="subitem"
                        />
                        <label for="cosmetic-bags">Cosmetic Bags</label>
                      </div>
                      <div class="sub-item-option">
                        <input
                          type="checkbox"
                          id="tech-accessories"
                          name="subitem"
                        />
                        <label for="tech-accessories">Tech Accessories</label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Page 2: Product Details -->
        <div class="form-page" id="page2">
          <div class="form-grid">
            Description
            <div class="form-group full-width">
              <label for="description">Description</label>
              <textarea
                id="description"
                name="description"
                rows="5"
                required
                placeholder="Describe your product in detail..."
              ></textarea>
            </div>

            Materials and Care
            <div class="form-group full-width">
              <label for="materials">Materials and Care</label>
              <textarea
                id="materials"
                name="materials"
                rows="4"
                required
                placeholder="e.g., 100% Cotton&#10;Machine wash cold&#10;Tumble dry low"
              ></textarea>
            </div>

            Details & Fit
            <div class="form-group full-width">
              <label for="detailsFit">Details & Fit</label>
              <textarea
                id="detailsFit"
                name="detailsFit"
                rows="4"
                placeholder="e.g., Relaxed fit&#10;Crew neckline&#10;Short sleeves&#10;Length: 26 inches"
              ></textarea>
            </div>

            Certifications
            <div class="form-group full-width">
              <label>Certifications (Sustainability)</label>
              <div class="certifications-container">
                <div class="certification-item">
                  <input
                    type="checkbox"
                    id="cert-organic"
                    name="certifications"
                    value="organic"
                  />
                  <label for="cert-organic">
                    <span class="cert-name">Organic Cotton</span>
                  </label>
                  <div class="cert-upload">
                    <input
                      type="file"
                      id="cert-organic-file"
                      accept="image/*"
                      class="cert-file-input"
                    />
                    <label for="cert-organic-file" class="cert-upload-btn"
                      >Upload Badge</label
                    >
                  </div>
                </div>
                <div class="certification-item">
                  <input
                    type="checkbox"
                    id="cert-fairtrade"
                    name="certifications"
                    value="fairtrade"
                  />
                  <label for="cert-fairtrade">
                    <span class="cert-name">Fair Trade</span>
                  </label>
                  <div class="cert-upload">
                    <input
                      type="file"
                      id="cert-fairtrade-file"
                      accept="image/*"
                      class="cert-file-input"
                    />
                    <label for="cert-fairtrade-file" class="cert-upload-btn"
                      >Upload Badge</label
                    >
                  </div>
                </div>
                <div class="certification-item">
                  <input
                    type="checkbox"
                    id="cert-recycled"
                    name="certifications"
                    value="recycled"
                  />
                  <label for="cert-recycled">
                    <span class="cert-name">Recycled Materials</span>
                  </label>
                  <div class="cert-upload">
                    <input
                      type="file"
                      id="cert-recycled-file"
                      accept="image/*"
                      class="cert-file-input"
                    />
                    <label for="cert-recycled-file" class="cert-upload-btn"
                      >Upload Badge</label
                    >
                  </div>
                </div>
                <div class="certification-item">
                  <input
                    type="checkbox"
                    id="cert-gots"
                    name="certifications"
                    value="gots"
                  />
                  <label for="cert-gots">
                    <span class="cert-name">GOTS Certified</span>
                  </label>
                  <div class="cert-upload">
                    <input
                      type="file"
                      id="cert-gots-file"
                      accept="image/*"
                      class="cert-file-input"
                    />
                    <label for="cert-gots-file" class="cert-upload-btn"
                      >Upload Badge</label
                    >
                  </div>
                </div>
                <div class="certification-item">
                  <input
                    type="checkbox"
                    id="cert-vegan"
                    name="certifications"
                    value="vegan"
                  />
                  <label for="cert-vegan">
                    <span class="cert-name">Vegan</span>
                  </label>
                  <div class="cert-upload">
                    <input
                      type="file"
                      id="cert-vegan-file"
                      accept="image/*"
                      class="cert-file-input"
                    />
                    <label for="cert-vegan-file" class="cert-upload-btn"
                      >Upload Badge</label
                    >
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Page 3: Stocks -->
        <div class="form-page" id="page3">
          <div class="page-header">
            <div class="page-header-left">
              <h2>Stock Management</h2>
              <p class="page-subtext">Manage inventory for your product</p>
            </div>
          </div>

          <div class="form-grid">
            <div class="form-group">
              <label for="sku">SKU (Stock Keeping Unit)</label>
              <input
                type="text"
                id="sku"
                name="sku"
                required
                placeholder="e.g., TSH-BLK-M-001"
              />
            </div>

            <div class="form-group">
              <label for="barcode">Barcode/UPC</label>
              <input
                type="text"
                id="barcode"
                name="barcode"
                placeholder="Enter barcode number"
              />
            </div>

            <div class="form-group">
              <label for="totalStock">Total Stock Quantity</label>
              <input
                type="number"
                id="totalStock"
                name="totalStock"
                required
                placeholder="0"
                min="0"
              />
            </div>

            <div class="form-group">
              <label for="lowStockThreshold">Low Stock Alert Threshold</label>
              <input
                type="number"
                id="lowStockThreshold"
                name="lowStockThreshold"
                placeholder="10"
                min="0"
              />
            </div>

            <div class="form-group full-width">
              <label>
                <input
                  type="checkbox"
                  id="trackInventory"
                  name="trackInventory"
                  checked
                />
                Track inventory for this product
              </label>
            </div>

            <div class="form-group full-width">
              <label>
                <input
                  type="checkbox"
                  id="allowBackorder"
                  name="allowBackorder"
                />
                Allow customers to purchase when out of stock
              </label>
            </div>

            Stock by Variant
            <div class="form-group full-width">
              <label>Stock by Size & Color</label>
              <div class="stock-variant-container" id="stockVariantContainer">
                <p class="info-text">
                  Select sizes and colors in Product Information to manage stock
                  by variant
                </p>
              </div>
            </div>

            <div class="form-group">
              <label for="supplier">Supplier</label>
              <input
                type="text"
                id="supplier"
                name="supplier"
                placeholder="Supplier name"
              />
            </div>

            <div class="form-group">
              <label for="leadTime">Lead Time (days)</label>
              <input
                type="number"
                id="leadTime"
                name="leadTime"
                placeholder="7"
                min="0"
              />
            </div>

            <div class="form-group">
              <label for="warehouseLocation">Warehouse Location</label>
              <input
                type="text"
                id="warehouseLocation"
                name="warehouseLocation"
                placeholder="e.g., Warehouse A, Shelf 12"
              />
            </div>

            <div class="form-group">
              <label for="reorderPoint">Reorder Point</label>
              <input
                type="number"
                id="reorderPoint"
                name="reorderPoint"
                placeholder="20"
                min="0"
              />
            </div>
          </div>
        </div>

        <!-- Navigation Buttons -->
        <div class="form-navigation">
          <button
            type="button"
            class="btn btn-secondary"
            id="backBtn"
            style="display: none"
          >
            <svg
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M19 12H5M12 19l-7-7 7-7" />
            </svg>
            Back
          </button>
          <div class="nav-spacer"></div>
          <button type="button" class="btn btn-primary" id="nextBtn">
            Next
            <svg
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M5 12h14M12 5l7 7-7 7" />
            </svg>
          </button>
          <button
            type="submit"
            class="btn btn-success"
            id="submitBtn"
            style="display: none"
          >
            <svg
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
            Add Product
          </button>
        </div>
      </form>

      <!-- RIGHT COLUMN: Sidebar with Model Information & Product Filters -->
      <div class="form-section-right">
        <!-- Model Information -->
        <div class="side-section">
          <div class="page-header">
            <div class="section-icon">
              <i class="ri-user-line"></i>
            </div>
            <div class="page-header-left">
              <h2>Model Information</h2>
              <p class="page-subtext">
                Add details about the model wearing the product
              </p>
            </div>
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label for="modelHeight">
                <i class="ri-height-line"></i>
                Model Height
              </label>
              <div class="input-with-suffix">
                <input
                  type="text"
                  id="modelHeight"
                  name="modelHeight"
                  placeholder="e.g., 5'9&quot;"
                />
                <span class="suffix">ft</span>
              </div>
            </div>

            <div class="form-group">
              <label for="wearingSize">
                <i class="ri-t-shirt-line"></i>
                Wearing Size
              </label>
              <select id="wearingSize" name="wearingSize">
                <option value="">Select size</option>
                <option value="xs">XS</option>
                <option value="s">S</option>
                <option value="m">M</option>
                <option value="l">L</option>
                <option value="xl">XL</option>
                <option value="xxl">XXL</option>
                <option value="xxxl">XXXL</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Product Filters -->
        <div class="side-section" id="filtersSection">
          <div class="page-header">
            <div class="section-icon">
              <i class="ri-filter-3-line"></i>
            </div>
            <div class="page-header-left">
              <h2>Product Filters</h2>
              <p class="page-subtext">
                Select applicable filters for your product
              </p>
            </div>
          </div>

          <!-- Dynamic Filters Container -->
          <div id="dynamicFiltersContainer">
            <!-- Filters will be dynamically inserted here based on selected subcategory -->
          </div>
          <div
            id="noFiltersMessage"
            style="
              display: none;
              text-align: center;
              padding: 1rem;
              color: #6b7280;
            "
          >
            <i
              class="ri-filter-off-line"
              style="font-size: 2rem; margin-bottom: 0.5rem"
            ></i>
            <p>Select a subcategory to view available filters</p>
          </div>

          <!-- Activewear Filters -->
          <div
            id="activewearFilters"
            class="filter-type-container"
            style="display: none"
          >
            <!-- Support Level -->
            <div class="filter-group">
              <button class="filter-header" type="button">
                <div class="filter-title">Support Level (Bras)</div>
                <i class="ri-arrow-down-s-line"></i>
              </button>
              <div class="filter-content">
                <div class="filter-options">
                  <div class="filter-option">
                    <input type="checkbox" name="support" value="Low" />
                    <span>Low</span>
                  </div>
                  <div class="filter-option">
                    <input type="checkbox" name="support" value="Medium" />
                    <span>Medium</span>
                  </div>
                  <div class="filter-option">
                    <input type="checkbox" name="support" value="High" />
                    <span>High</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Fit -->
            <div class="filter-group">
              <button class="filter-header" type="button">
                <div class="filter-title">Fit</div>
                <i class="ri-arrow-down-s-line"></i>
              </button>
              <div class="filter-content">
                <div class="filter-options">
                  <div class="filter-option">
                    <input type="checkbox" name="fit" value="Slim" />
                    <span>Slim</span>
                  </div>
                  <div class="filter-option">
                    <input type="checkbox" name="fit" value="Relaxed" />
                    <span>Relaxed</span>
                  </div>
                  <div class="filter-option">
                    <input type="checkbox" name="fit" value="Compression" />
                    <span>Compression</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Material -->
            <div class="filter-group">
              <button class="filter-header" type="button">
                <div class="filter-title">Material</div>
                <i class="ri-arrow-down-s-line"></i>
              </button>
              <div class="filter-content">
                <div class="filter-options">
                  <div class="filter-option">
                    <input type="checkbox" name="material" value="Spandex" />
                    <span>Spandex</span>
                  </div>
                  <div class="filter-option">
                    <input type="checkbox" name="material" value="Nylon" />
                    <span>Nylon</span>
                  </div>
                  <div class="filter-option">
                    <input
                      type="checkbox"
                      name="material"
                      value="Cotton blend"
                    />
                    <span>Cotton blend</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Activity -->
            <div class="filter-group">
              <button class="filter-header" type="button">
                <div class="filter-title">Activity</div>
                <i class="ri-arrow-down-s-line"></i>
              </button>
              <div class="filter-content">
                <div class="filter-options">
                  <div class="filter-option">
                    <input type="checkbox" name="activity" value="Yoga" />
                    <span>Yoga</span>
                  </div>
                  <div class="filter-option">
                    <input type="checkbox" name="activity" value="Gym" />
                    <span>Gym</span>
                  </div>
                  <div class="filter-option">
                    <input type="checkbox" name="activity" value="Running" />
                    <span>Running</span>
                  </div>
                  <div class="filter-option">
                    <input type="checkbox" name="activity" value="Casual" />
                    <span>Casual</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock %} {% block extra_js %}
<script src="{{ url_for('static', filename='js/seller_scripts/add_product_flow.js') }}"></script>
<script src="{{ url_for('static', filename='js/seller_scripts/add_product.js') }}"></script>

<!-- Product Photo Upload System -->
<style>
/* Product Photo Upload Styling */
.product-photo-container {
  display: flex;
  gap: 20px;
  flex-wrap: wrap;
  justify-content: flex-start;
  margin-top: 10px;
}

.product-photo-upload {
  width: 120px;
  height: 120px;
  border: 2px dashed #d1d5db;
  border-radius: 12px;
  cursor: pointer;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

.product-photo-upload:hover {
  border-color: #a259f7;
  background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%);
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(162, 89, 247, 0.15);
}

.product-photo-upload:active {
  transform: translateY(0);
  box-shadow: 0 4px 12px rgba(162, 89, 247, 0.2);
}

.photo-placeholder {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  color: #6b7280;
  font-size: 12px;
  font-weight: 500;
  gap: 6px;
  padding: 8px;
}

.photo-placeholder i {
  font-size: 28px;
  color: #a259f7;
  margin-bottom: 4px;
}

.photo-placeholder span {
  font-weight: 600;
  line-height: 1.2;
}

.photo-placeholder small {
  font-size: 10px;
  color: #9ca3af;
  font-weight: 400;
}

.photo-preview {
  width: 100%;
  height: 100%;
  object-fit: cover;
  border-radius: 10px;
  transition: transform 0.2s ease;
  position: absolute;
  top: 0;
  left: 0;
  z-index: 1;
}

.product-photo-upload:hover .photo-preview {
  transform: scale(1.02);
}

/* Ensure upload area can contain positioned elements */
.product-photo-upload {
  position: relative;
}

.photo-remove {
  position: absolute;
  top: -6px;
  right: -6px;
  width: 24px;
  height: 24px;
  background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
  color: white;
  border: 2px solid white;
  border-radius: 50%;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  font-weight: bold;
  z-index: 10;
  opacity: 0;
  transition: all 0.2s ease;
  box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);
}

.product-photo-upload:hover .photo-remove {
  opacity: 1;
  transform: scale(1);
}

.photo-remove:hover {
  background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
  transform: scale(1.1);
  box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
}

.photo-remove:active {
  transform: scale(0.95);
}

/* Loading state styling */
.photo-loading {
  border-color: #a259f7;
  background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%);
}

.photo-loading .photo-placeholder i {
  animation: photoSpin 1s linear infinite;
  color: #a259f7;
}

@keyframes photoSpin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Success state styling */
.photo-success {
  border: 2px solid #10b981;
  background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
  box-shadow: 0 8px 25px rgba(16, 185, 129, 0.15);
}

/* Error state styling */
.photo-error {
  border: 2px solid #ef4444;
  background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
  animation: photoShake 0.5s ease-in-out;
}

@keyframes photoShake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-3px); }
  75% { transform: translateX(3px); }
}

.form-help-text {
  font-size: 14px;
  color: #6b7280;
  margin-bottom: 12px;
  line-height: 1.4;
}
</style>

<script>
console.log("ðŸ†• Product Photo Upload System Loading...");

class ProductPhotoUpload {
  constructor() {
    this.init();
  }

  init() {
    console.log("Initializing product photo upload system...");
    this.setupPhotoUploads();
  }

  setupPhotoUploads() {
    const uploads = document.querySelectorAll('.product-photo-upload');
    console.log(`Found ${uploads.length} product photo upload areas`);
    
    uploads.forEach((upload) => {
      this.setupPhotoUpload(upload);
    });
  }

  setupPhotoUpload(uploadArea) {
    const photoType = uploadArea.dataset.photoType;
    console.log(`Setting up photo upload for ${photoType} photo`);
    
    const input = uploadArea.querySelector('.photo-input');
    const placeholder = uploadArea.querySelector('.photo-placeholder');
    
    if (!input || !placeholder) {
      console.error(`Missing elements for ${photoType} photo`);
      return;
    }

    // Click handler for upload area
    uploadArea.addEventListener('click', (e) => {
      // Don't trigger if clicking on remove button
      if (e.target.classList.contains('photo-remove')) {
        return;
      }
      
      console.log(`${photoType} photo upload clicked`);
      input.click();
    });

    // File input change handler
    input.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file) {
        console.log(`File selected for ${photoType} photo:`, file.name);
        this.handleFileUpload(file, uploadArea, input, photoType);
      }
    });
  }

  handleFileUpload(file, uploadArea, input, photoType) {
    // Validate file
    if (!this.validateFile(file)) {
      input.value = '';
      return;
    }

    // Show loading state
    this.showLoading(uploadArea);

    // Compress and resize image before processing
    this.compressImage(file, 800, 800, 0.8).then(compressedDataUrl => {
      this.displayPhoto(compressedDataUrl, uploadArea, input, photoType);
    }).catch(error => {
      console.error(`Error processing file for ${photoType} photo:`, error);
      alert('Error processing the selected file. Please try again.');
      this.showErrorState(uploadArea);
      input.value = '';
      
      // Reset to normal state after 3 seconds
      setTimeout(() => {
        this.hideLoading(uploadArea);
      }, 3000);
    });
  }

  compressImage(file, maxWidth, maxHeight, quality) {
    return new Promise((resolve, reject) => {
      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');
      const img = new Image();
      
      img.onload = () => {
        // Calculate new dimensions
        let { width, height } = img;
        
        if (width > height) {
          if (width > maxWidth) {
            height = (height * maxWidth) / width;
            width = maxWidth;
          }
        } else {
          if (height > maxHeight) {
            width = (width * maxHeight) / height;
            height = maxHeight;
          }
        }
        
        // Set canvas dimensions
        canvas.width = width;
        canvas.height = height;
        
        // Draw and compress
        ctx.drawImage(img, 0, 0, width, height);
        
        // Convert to data URL with compression
        const compressedDataUrl = canvas.toDataURL('image/jpeg', quality);
        
        console.log(`Image compressed: ${file.size} bytes â†’ ${Math.round(compressedDataUrl.length * 0.75)} bytes`);
        resolve(compressedDataUrl);
      };
      
      img.onerror = () => reject(new Error('Failed to load image'));
      
      // Create object URL for the image
      img.src = URL.createObjectURL(file);
    });
  }

  validateFile(file) {
    // Check file type
    if (!file.type.startsWith('image/')) {
      alert('Please select an image file (JPG, PNG, GIF, etc.)');
      return false;
    }

    // Check file size (10MB limit for original file, will be compressed)
    const maxSize = 10 * 1024 * 1024;
    if (file.size > maxSize) {
      alert('File is too large. Please select an image smaller than 10MB.');
      return false;
    }

    return true;
  }

  showLoading(uploadArea) {
    const placeholder = uploadArea.querySelector('.photo-placeholder');
    if (placeholder) {
      placeholder.innerHTML = '<i class="ri-loader-4-line"></i><span>Uploading...</span><small>Please wait</small>';
    }
    uploadArea.classList.add('photo-loading');
    uploadArea.classList.remove('photo-success', 'photo-error');
  }

  hideLoading(uploadArea) {
    const photoType = uploadArea.dataset.photoType;
    const placeholder = uploadArea.querySelector('.photo-placeholder');
    if (placeholder) {
      const icon = photoType === 'primary' ? 'ri-camera-line' : 'ri-image-line';
      const label = photoType === 'primary' ? 'Main Photo' : 'Secondary Photo';
      placeholder.innerHTML = `<i class="${icon}"></i><span>${label}</span><small>Click to upload</small>`;
    }
    uploadArea.classList.remove('photo-loading', 'photo-success', 'photo-error');
  }

  showErrorState(uploadArea) {
    const placeholder = uploadArea.querySelector('.photo-placeholder');
    if (placeholder) {
      placeholder.innerHTML = '<i class="ri-error-warning-line"></i><span>Error</span><small>Try again</small>';
    }
    uploadArea.classList.add('photo-error');
    uploadArea.classList.remove('photo-loading', 'photo-success');
  }

  displayPhoto(imageSrc, uploadArea, input, photoType) {
    console.log(`Displaying photo for ${photoType} photo`);
    
    // Clear existing content but keep the input
    uploadArea.innerHTML = '';
    uploadArea.appendChild(input);
    
    // Create image element with proper styling
    const img = document.createElement('img');
    img.src = imageSrc;
    img.className = 'photo-preview';
    img.alt = `${photoType} photo`;
    img.style.cssText = `
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 10px;
      display: block;
      position: absolute;
      top: 0;
      left: 0;
      z-index: 1;
    `;
    
    // Create remove button
    const removeBtn = document.createElement('button');
    removeBtn.type = 'button';
    removeBtn.className = 'photo-remove';
    removeBtn.innerHTML = 'Ã—';
    removeBtn.title = 'Remove photo';
    removeBtn.style.cssText = `
      position: absolute;
      top: -6px;
      right: -6px;
      width: 24px;
      height: 24px;
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      color: white;
      border: 2px solid white;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: bold;
      z-index: 10;
      opacity: 0;
      transition: all 0.2s ease;
      box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);
    `;
    
    // Remove button click handler
    removeBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      this.removePhoto(uploadArea, input, photoType);
    });
    
    // Add elements to upload area
    uploadArea.appendChild(img);
    uploadArea.appendChild(removeBtn);
    
    // Update upload area styling to show image properly
    uploadArea.style.position = 'relative';
    uploadArea.style.overflow = 'hidden';
    
    // Add success styling
    uploadArea.classList.add('photo-success');
    uploadArea.classList.remove('photo-loading', 'photo-error');
    
    // Show remove button on hover
    uploadArea.addEventListener('mouseenter', () => {
      removeBtn.style.opacity = '1';
    });
    
    uploadArea.addEventListener('mouseleave', () => {
      removeBtn.style.opacity = '0';
    });
    
    // Store the image data for form submission
    this.storePhotoData(imageSrc, photoType);
    
    console.log(`Photo displayed successfully for ${photoType} photo`);
  }

  removePhoto(uploadArea, input, photoType) {
    console.log(`Removing ${photoType} photo`);
    
    // Clear file input
    input.value = '';
    
    // Reset upload area
    uploadArea.innerHTML = '';
    uploadArea.appendChild(input);
    
    // Add placeholder back
    const placeholder = document.createElement('div');
    placeholder.className = 'photo-placeholder';
    const icon = photoType === 'primary' ? 'ri-camera-line' : 'ri-image-line';
    const label = photoType === 'primary' ? 'Main Photo' : 'Secondary Photo';
    placeholder.innerHTML = `<i class="${icon}"></i><span>${label}</span><small>Click to upload</small>`;
    uploadArea.appendChild(placeholder);
    
    // Reset styling
    uploadArea.classList.remove('photo-success', 'photo-loading', 'photo-error');
    uploadArea.style.position = 'relative';
    uploadArea.style.overflow = 'hidden';
    
    // Remove event listeners
    uploadArea.onmouseenter = null;
    uploadArea.onmouseleave = null;
    
    // Remove stored photo data
    this.removePhotoData(photoType);
    
    // Re-setup the upload functionality
    this.setupPhotoUpload(uploadArea);
    
    console.log(`${photoType} photo removed successfully`);
  }

  storePhotoData(imageSrc, photoType) {
    // Store the base64 data in the appropriate hidden input
    const fieldId = photoType === 'primary' ? 'primaryImageField' : 'secondaryImageField';
    const hiddenInput = document.getElementById(fieldId);
    
    if (hiddenInput) {
      hiddenInput.value = imageSrc;
      console.log(`Photo data stored for ${photoType} photo`);
    } else {
      console.error(`Hidden input not found for ${photoType} photo`);
    }
  }

  removePhotoData(photoType) {
    // Clear the hidden input
    const fieldId = photoType === 'primary' ? 'primaryImageField' : 'secondaryImageField';
    const hiddenInput = document.getElementById(fieldId);
    
    if (hiddenInput) {
      hiddenInput.value = '';
      console.log(`Photo data removed for ${photoType} photo`);
    }
  }
}

// Initialize when DOM is ready
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', () => {
    window.productPhotoUpload = new ProductPhotoUpload();
  });
} else {
  window.productPhotoUpload = new ProductPhotoUpload();
}

console.log("âœ… Product Photo Upload System Loaded");
</script>
{% endblock %}
