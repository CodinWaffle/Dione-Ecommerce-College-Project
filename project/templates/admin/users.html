{% extends "admin/base_admin.html" %}

{% block page_title %}User Management{% endblock %}

{% block admin_content %}
<section>
  <h2 class="section-title">
    <i class="fas fa-users"></i>
    User Management
  </h2>

  <!-- Pending Requests Section -->
  <div class="mb-4">
    <h5 class="mb-3"><i class="fas fa-hourglass-half text-warning"></i> Pending Seller & Rider Requests</h5>
    <div class="modern-table">
      <div class="table-responsive">
        <table class="table table-sm">
          <thead>
            <tr>
              <th>Name</th>
              <th>Email</th>
              <th>Requesting</th>
              <th>Date</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for req in pending_requests %}
            <tr>
              <td><strong>{{ req.username }}</strong></td>
              <td>{{ req.email }}</td>
              <td><span class="badge badge-primary">{{ req.role_requested.capitalize() }}</span></td>
              <td><small class="text-muted">{{ req.created_at.strftime('%b %d, %Y') if req.created_at else 'N/A' }}</small></td>
              <td>
                <div class="btn-group btn-group-sm" role="group">
                  <form method="post" action="{{ url_for('admin.approve_request', user_id=req.id) }}" class="d-inline" style="display: inline;">
                    <button class="btn btn-success" type="submit" title="Approve Request">
                      <i class="fas fa-check"></i>
                    </button>
                  </form>
                  <form method="post" action="{{ url_for('admin.reject_request', user_id=req.id) }}" class="d-inline" style="display: inline;">
                    <button class="btn btn-danger" type="submit" title="Reject Request">
                      <i class="fas fa-times"></i>
                    </button>
                  </form>
                </div>
              </td>
            </tr>
            {% else %}
            <tr>
              <td colspan="5" class="text-center text-muted py-3">No pending requests</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-md-4 mb-4">
      <h5 class="mb-3"><i class="fas fa-shopping-bag text-success"></i> Buyers</h5>
      <div class="modern-table">
        <div class="table-responsive">
          <table class="table table-sm">
            <thead>
              <tr>
                <th>Name</th>
                <th>Email</th>
              </tr>
            </thead>
            <tbody>
              {% for u in buyers %}
              <tr>
                <td><strong>{{ u.username }}</strong></td>
                <td>{{ u.email }}</td>
              </tr>
              {% else %}
              <tr>
                <td colspan="2" class="text-center text-muted">No buyers found</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
    <div class="col-md-4 mb-4">
      <h5 class="mb-3"><i class="fas fa-store text-warning"></i> Sellers</h5>
      <div class="modern-table">
        <div class="table-responsive">
          <table class="table table-sm">
            <thead>
              <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for u in sellers %}
              <tr>
                <td><strong>{{ u.username }}</strong></td>
                <td>{{ u.email }}</td>
                <td>
                  {% if u.is_suspended %}
                  <span class="badge badge-modern badge-danger">Suspended</span>
                  {% else %}
                  <span class="badge badge-modern badge-success">Active</span>
                  {% endif %}
                </td>
                <td>
                  <div class="btn-group" role="group">
                    {% if not u.is_suspended %}
                    <form method="post" action="{{ url_for('admin.user_suspend', user_id=u.id) }}" class="d-inline">
                      <button class="btn btn-modern btn-warning btn-sm" type="submit" title="Suspend">
                        <i class="fas fa-ban"></i>
                      </button>
                    </form>
                    {% else %}
                    <form method="post" action="{{ url_for('admin.user_reactivate', user_id=u.id) }}" class="d-inline">
                      <button class="btn btn-modern btn-info btn-sm" type="submit" title="Reactivate">
                        <i class="fas fa-check-circle"></i>
                      </button>
                    </form>
                    {% endif %}
                    <form method="post" action="{{ url_for('admin.user_delete', user_id=u.id) }}" class="d-inline" onsubmit="return confirm('Are you sure you want to delete this user?');">
                      <button class="btn btn-modern btn-danger btn-sm" type="submit" title="Delete">
                        <i class="fas fa-trash"></i>
                      </button>
                    </form>
                  </div>
                </td>
              </tr>
              {% else %}
              <tr>
                <td colspan="4" class="text-center text-muted">No sellers found</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
    <div class="col-md-4 mb-4">
      <h5 class="mb-3"><i class="fas fa-motorcycle text-info"></i> Riders</h5>
      <div class="modern-table">
        <div class="table-responsive">
          <table class="table table-sm">
            <thead>
              <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for u in riders %}
              <tr>
                <td><strong>{{ u.username }}</strong></td>
                <td>{{ u.email }}</td>
                <td>
                  {% if u.is_suspended %}
                  <span class="badge badge-modern badge-danger">Suspended</span>
                  {% else %}
                  <span class="badge badge-modern badge-success">Active</span>
                  {% endif %}
                </td>
                <td>
                  <div class="btn-group" role="group">
                    {% if not u.is_suspended %}
                    <form method="post" action="{{ url_for('admin.user_suspend', user_id=u.id) }}" class="d-inline">
                      <button class="btn btn-modern btn-warning btn-sm" type="submit" title="Suspend">
                        <i class="fas fa-ban"></i>
                      </button>
                    </form>
                    {% else %}
                    <form method="post" action="{{ url_for('admin.user_reactivate', user_id=u.id) }}" class="d-inline">
                      <button class="btn btn-modern btn-info btn-sm" type="submit" title="Reactivate">
                        <i class="fas fa-check-circle"></i>
                      </button>
                    </form>
                    {% endif %}
                    <form method="post" action="{{ url_for('admin.user_delete', user_id=u.id) }}" class="d-inline" onsubmit="return confirm('Are you sure you want to delete this user?');">
                      <button class="btn btn-modern btn-danger btn-sm" type="submit" title="Delete">
                        <i class="fas fa-trash"></i>
                      </button>
                    </form>
                  </div>
                </td>
              </tr>
              {% else %}
              <tr>
                <td colspan="4" class="text-center text-muted">No riders found</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</section>
{% endblock %}

