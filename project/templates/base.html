<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE-edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Dione Ecommerce</title>
  <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='image/favicon-32x32.png') }}">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css" integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous"/>
  <link rel=stylesheet type=text/css href="{{ url_for('static', filename='css/style.css')}}">
  {% block extra_head %}{% endblock %}

</head>
<body class="{% block body_class %}{% endblock %}">
  <nav class="navbar dione-navbar">
    <div class="nav-shell">
      <div class="nav-start">
        <a class="navbar-brand" href="{{ url_for('main.index') }}" title="Back to home">
          <img
            src="{{ url_for('static', filename='image/dione logo.png') }}"
            alt="Dione home"
            class="brand-logo"
          >
        </a>
        <a class="nav-link" href="{{ url_for('shop.catalog') }}">Shop</a>
        <a class="nav-link" href="{{ url_for('shop.catalog') }}#categories">Categories</a>
        {% if current_user.is_authenticated and current_user.role in ['seller','rider'] %}
          {% if current_user.role == 'seller' %}
            <a class="nav-link" href="{{ url_for('seller.dashboard') }}">Dashboard</a>
          {% else %}
            <a class="nav-link" href="{{ url_for('main.rider_dashboard') }}">Dashboard</a>
          {% endif %}
        {% endif %}
      </div>

      <form class="navbar-search" action="{{ url_for('shop.catalog') }}" method="get" role="search">
        <span class="search-icon"><i class="fas fa-search"></i></span>
        <input
          type="text"
          name="q"
          value="{{ request.args.get('q', '') if request else '' }}"
          placeholder="Search products"
          aria-label="Search products"
        >
        <button type="submit">Search</button>
      </form>

      <div class="nav-end">
        {% if current_user.is_authenticated and current_user.role not in ['seller','rider'] %}
          <a class="nav-icon-link" href="{{ url_for('shop.cart') }}" title="Cart">
            <i class="fas fa-shopping-bag"></i>
            <span>Cart</span>
          </a>
        {% endif %}
        {% if not current_user.is_authenticated %}
          <a class="nav-ghost-btn nav-transition" href="{{ url_for('auth.login') }}">Login</a>
          <a class="nav-solid-btn nav-transition" href="{{ url_for('auth.signup') }}">Sign up</a>
        {% else %}
          <a class="nav-ghost-btn" href="{{ url_for('auth.logout') }}">Logout</a>
        {% endif %}

        <div class="profile-pill">
          <span class="avatar">
            {% if current_user.is_authenticated %}
              {{ (current_user.username or current_user.email or 'U')[0]|upper }}
            {% else %}
              <i class="fas fa-user"></i>
            {% endif %}
          </span>
          <div class="profile-meta">
            {% if current_user.is_authenticated %}
              <small>Signed in</small>
              <strong>{{ current_user.username or current_user.email or 'User' }}</strong>
            {% else %}
              <small>Guest</small>
              <strong>Sign in</strong>
            {% endif %}
          </div>
          {% if current_user.is_authenticated %}
            {% if current_user.role not in ['seller','rider'] %}
              <a class="stretched-link" href="{{ url_for('main.profile') }}" aria-label="View profile"></a>
            {% else %}
              <a class="stretched-link" href="{{ url_for('seller.dashboard') if current_user.role == 'seller' else url_for('main.rider_dashboard') }}" aria-label="View dashboard"></a>
            {% endif %}
          {% endif %}
        </div>
      </div>
    </div>
  </nav>

  <div class="transition-overlay" id="transitionOverlay" aria-hidden="true">
    <div class="transition-card">
      <h4>Preparing your dashboard</h4>
      <p>Please hold for a moment...</p>
      <div class="loading-dots">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
  </div>

    <div class="container-fluid">
      {% block flash_messages %}
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            <div class="flash-stack">
              {% for category, message in messages %}
                {% set alert_class = 'warning' if category == 'message' else category %}
                <div class="flash-card flash-{{ alert_class }}" role="alert">
                  <div class="flash-body">
                    <strong>{{ alert_class|capitalize }}</strong>
                    <p>{{ message }}</p>
                  </div>
                  <button type="button" class="flash-close" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
              {% endfor %}
            </div>
          {% endif %}
        {% endwith %}
      {% endblock %}
      {% block content %}
      {% endblock %}
    </div>

  <footer class="site-footer">
    <div class="footer-inner container-narrow">
      <div class="footer-brand">
        <img src="{{ url_for('static', filename='image/dione logo.png') }}" alt="Dione logo">
        <div>
          <strong>Dione Ecommerce</strong>
          <p>Built for students, local sellers, and modern shoppers.</p>
        </div>
      </div>
      <div class="footer-links">
        <a href="{{ url_for('shop.catalog') }}">Shop</a>
        <a href="{{ url_for('shop.catalog') }}#categories">Categories</a>
        <a href="{{ url_for('auth.signup') }}">Become a seller</a>
      </div>
      <div class="footer-meta">
        <p>&copy; Dione Marketplace. All rights reserved.</p>
      </div>
    </div>
  </footer>
  {% block extra_scripts %}{% endblock %}
  <script>
  document.addEventListener('DOMContentLoaded', function() {
    const overlay = document.getElementById('transitionOverlay');
    if (overlay) {
      const forms = document.querySelectorAll('.auth-transition-form');
      const navLinks = document.querySelectorAll('.nav-transition');
      forms.forEach(form => {
        form.addEventListener('submit', () => {
          overlay.classList.add('show');
        }, { once: true });
      });
      navLinks.forEach(link => {
        link.addEventListener('click', () => {
          overlay.classList.add('show');
        });
      });
    }

    const flashCards = document.querySelectorAll('.flash-card');
    flashCards.forEach(card => {
      const closeBtn = card.querySelector('.flash-close');
      const removeCard = () => {
        card.classList.add('hide');
        card.addEventListener('animationend', () => card.remove(), { once: true });
      };
      if (closeBtn) {
        closeBtn.addEventListener('click', removeCard);
      }
      setTimeout(removeCard, 5000);
    });
  });
  </script>
</body>

</html>
