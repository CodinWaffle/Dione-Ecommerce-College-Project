<!-- Reviews Grid Component -->
<!-- Main Reviews Header Section -->
<header class="reviews-main-header">
  <div class="reviews-header-content">
    <h3 class="reviews-title">Ratings & Reviews</h3>

    <!-- Sort and Filter Controls -->
    <div class="reviews-controls">
      <div class="sort-filter-container">
        <div class="sort-section">
          <label class="sort-label">Sort by:</label>
          <select
            class="sort-select"
            id="reviewSortSelect"
            onchange="sortReviews(this.value)"
          >
            <option value="newest">Newest First</option>
            <option value="oldest">Oldest First</option>
            <option value="highest-rating">Highest Rating</option>
            <option value="lowest-rating">Lowest Rating</option>
            <option value="most-helpful">Most Helpful</option>
          </select>
        </div>

        <div class="filter-section">
          <label class="filter-label">Filter by:</label>
          <select
            class="filter-select"
            id="reviewFilterSelect"
            onchange="filterReviews(this.value)"
          >
            <option value="all">All Reviews</option>
            <option value="5-stars">5 Stars</option>
            <option value="4-stars">4 Stars</option>
            <option value="3-stars">3 Stars</option>
            <option value="2-stars">2 Stars</option>
            <option value="1-star">1 Star</option>
            <option value="with-photos">With Photos</option>
            <option value="verified-only">Verified Buyers Only</option>
          </select>
        </div>

        <div class="variation-filter-section">
          <label class="variation-label">Variation:</label>
          <select
            class="variation-select"
            id="variationFilterSelect"
            onchange="filterByVariation(this.value)"
          >
            <option value="all">All Variations</option>
            <option value="XS-Black">XS - Black</option>
            <option value="S-Black">S - Black</option>
            <option value="M-Black">M - Black</option>
            <option value="L-Black">L - Black</option>
            <option value="XL-Black">XL - Black</option>
            <option value="XS-White">XS - White</option>
            <option value="S-White">S - White</option>
            <option value="M-White">M - White</option>
            <option value="L-White">L - White</option>
            <option value="XL-White">XL - White</option>
          </select>
        </div>

        <button class="clear-filters-btn" onclick="clearAllFilters()">
          <i class="fas fa-times"></i>
          Clear Filters
        </button>
      </div>
    </div>

    <div class="reviews-stats">
      <div class="average-rating">
        <div class="rating-display">
          <span class="rating-number"
            >{{ average_rating|round(1) if average_rating else 0 }}</span
          >
          <div class="stars-large">
            {% for i in range(1, 6) %}
            <i
              class="fas fa-star{% if i > (average_rating or 0) %} star-empty{% endif %}"
            ></i>
            {% endfor %}
          </div>
        </div>
        <span class="total-reviews"
          >Based on {{ reviews|length if reviews else 0 }} reviews</span
        >
      </div>

      <!-- Ratings Breakdown -->
      <div class="ratings-breakdown">
        {% set rating_counts = {5: 0, 4: 0, 3: 0, 2: 0, 1: 0} %} {% if reviews
        %} {% for review in reviews %} {% set _ =
        rating_counts.update({review.rating: rating_counts[review.rating] + 1})
        %} {% endfor %} {% endif %} {% for star_rating in [5, 4, 3, 2, 1] %}
        <div class="rating-breakdown-item">
          <span class="star-label">{{ star_rating }}</span>
          <i class="fas fa-star"></i>
          <div class="rating-bar">
            <div
              class="rating-fill"
              style="width: {{ (rating_counts[star_rating] / (reviews|length if reviews else 1)) * 100 }}%"
            ></div>
          </div>
          <span class="rating-count">{{ rating_counts[star_rating] }}</span>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>
</header>

<div class="reviews-container">
  <div class="reviews-grid">
    {% if reviews %} {% for review in reviews %}
    <!-- Individual Review Card -->
    <div class="review-card" data-review-id="{{ review.id }}">
      <!-- Header with profile and menu -->
      <div class="review-card-header">
        <div class="profile-section">
          <img
            src="{{ review.user.profile_image if review.user.profile_image else url_for('static', filename='images/default-avatar.png') }}"
            alt="Profile"
            class="profile-photo"
          />
          <div class="profile-info">
            <h3 class="username">
              {{ review.user.first_name }} {{ review.user.last_name[0] if
              review.user.last_name else '' }}.
            </h3>
            <span class="verified-buyer">
              <i class="fas fa-check-circle"></i>
              Verified Buyer
            </span>
          </div>
        </div>
        {% if current_user.is_authenticated and current_user.id ==
        review.user_id %}
        <div class="menu-section">
          <button class="menu-btn" onclick="toggleReviewMenu({{ review.id }})">
            <i class="fas fa-ellipsis-v"></i>
          </button>
          <div class="dropdown-menu" id="reviewMenu{{ review.id }}">
            <button onclick="editReview({{ review.id }})">
              <i class="fas fa-edit"></i>
              Edit Review
            </button>
            <button onclick="removeReview({{ review.id }})" class="delete-btn">
              <i class="fas fa-trash"></i>
              Remove Review
            </button>
          </div>
        </div>
        {% endif %}
      </div>

      <!-- Overall Rating -->
      <div class="overall-rating">
        <div class="stars" data-rating="{{ review.rating }}">
          {% for i in range(1, 6) %}
          <i
            class="fas fa-star{% if i > review.rating %} star-empty{% endif %}"
          ></i>
          {% endfor %}
        </div>
        <span class="rating-text"
          >{{ review.title if review.title else 'Great product!' }}</span
        >
      </div>

      <!-- Detailed Ratings (if available) -->
      {% if review.detailed_ratings %}
      <div class="detailed-ratings">
        {% for category, rating in review.detailed_ratings.items() %}
        <div class="rating-item">
          <span class="rating-label">{{ category|title }}</span>
          <div class="stars small" data-rating="{{ rating }}">
            {% for i in range(1, 6) %}
            <i class="fas fa-star{% if i > rating %} star-empty{% endif %}"></i>
            {% endfor %}
          </div>
        </div>
        {% endfor %}
      </div>
      {% endif %}

      <!-- Order Variation -->
      {% if review.product_variation %}
      <div class="order-variation">
        <span class="variation-label">Purchased:</span>
        <span class="variation-details">{{ review.product_variation }}</span>
      </div>
      {% endif %}

      <!-- Review Text -->
      <div class="review-text" id="reviewText{{ review.id }}">
        <p>{{ review.comment }}</p>
      </div>

      <!-- Product Media -->
      {% if review.images or review.video %}
      <div class="product-media">
        {% if review.images %} {% for image in review.images %}
        <div class="media-item">
          <img
            src="{{ url_for('static', filename='uploads/' + image) }}"
            alt="Review photo"
            class="product-image"
            onclick="openImageLightbox('{{ url_for('static', filename='uploads/' + image) }}')"
          />
        </div>
        {% endfor %} {% endif %} {% if review.video %}
        <div class="media-item">
          <div class="video-container">
            <video controls class="product-video">
              <source
                src="{{ url_for('static', filename='uploads/' + review.video) }}"
                type="video/mp4"
              />
              Your browser does not support the video tag.
            </video>
          </div>
        </div>
        {% endif %}
      </div>
      {% endif %}
    </div>
    {% endfor %} {% else %}
    <!-- Show sample reviews as placeholders when no real reviews exist -->
    <div class="sample-reviews-header">
      <h4>Sample Reviews</h4>
      <p class="muted">
        Example reviews to show how ratings appear on this product.
      </p>
    </div>

    <div class="review-card sample" data-review-id="sample-1">
      <div class="review-card-header">
        <div class="profile-section">
          <img
            src="{{ url_for('static', filename='image/banner.png') }}"
            alt="Profile"
            class="profile-photo"
          />
          <div class="profile-info">
            <h3 class="username">Maria S.</h3>
            <span class="verified-buyer"
              ><i class="fas fa-check-circle"></i> Verified Buyer</span
            >
          </div>
        </div>
      </div>
      <div class="overall-rating">
        <div class="stars" data-rating="5">
          <i class="fas fa-star"></i><i class="fas fa-star"></i
          ><i class="fas fa-star"></i><i class="fas fa-star"></i
          ><i class="fas fa-star"></i>
        </div>
        <span class="rating-text">Excellent quality and fit</span>
      </div>
      <div class="review-text">
        <p>
          I loved the fabric and the color — exactly as pictured. The size fits
          perfectly.
        </p>
      </div>
      <div class="product-media">
        <div class="media-item">
          <img
            src="{{ url_for('static', filename='image/banner.png') }}"
            alt="Review photo"
            class="product-image"
            onclick="openImageLightbox('{{ url_for('static', filename='image/banner.png') }}')"
          />
        </div>
      </div>
    </div>

    <div class="review-card sample" data-review-id="sample-2">
      <div class="review-card-header">
        <div class="profile-section">
          <img
            src="{{ url_for('static', filename='image/banner.png') }}"
            alt="Profile"
            class="profile-photo"
          />
          <div class="profile-info">
            <h3 class="username">Anton K.</h3>
            <span class="verified-buyer"
              ><i class="fas fa-check-circle"></i> Verified Buyer</span
            >
          </div>
        </div>
      </div>
      <div class="overall-rating">
        <div class="stars" data-rating="4">
          <i class="fas fa-star"></i><i class="fas fa-star"></i
          ><i class="fas fa-star"></i><i class="fas fa-star"></i
          ><i class="fas fa-star star-empty"></i>
        </div>
        <span class="rating-text">Good value for money</span>
      </div>
      <div class="review-text">
        <p>
          Comfortable and looks great. Delivery was fast. Minor stitching issue
          but overall satisfied.
        </p>
      </div>
    </div>

    <div class="review-card sample" data-review-id="sample-3">
      <div class="review-card-header">
        <div class="profile-section">
          <img
            src="{{ url_for('static', filename='image/banner.png') }}"
            alt="Profile"
            class="profile-photo"
          />
          <div class="profile-info">
            <h3 class="username">Liza P.</h3>
            <span class="verified-buyer"
              ><i class="fas fa-check-circle"></i> Verified Buyer</span
            >
          </div>
        </div>
      </div>
      <div class="overall-rating">
        <div class="stars" data-rating="3">
          <i class="fas fa-star"></i><i class="fas fa-star"></i
          ><i class="fas fa-star"></i><i class="fas fa-star star-empty"></i
          ><i class="fas fa-star star-empty"></i>
        </div>
        <span class="rating-text">Average — size down recommended</span>
      </div>
      <div class="review-text">
        <p>
          The product is okay but runs a bit large. The material is decent for
          the price.
        </p>
      </div>
    </div>

    {% endif %}
  </div>
</div>

<!-- Image Lightbox Modal -->
<div id="imageLightbox" class="lightbox-modal">
  <span class="lightbox-close" onclick="closeLightbox()">&times;</span>
  <img class="lightbox-content" id="lightboxImage" />
</div>
