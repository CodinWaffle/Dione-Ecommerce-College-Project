<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photo Upload Test</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .photo-upload-box {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            width: 56px;
            height: 56px;
            border: 2px dashed #d1d5db;
            border-radius: 10px;
            background: #f8fafc;
            cursor: pointer;
            position: relative;
            transition: border-color 0.2s;
            margin: 10px;
        }

        .photo-upload-box.grey {
            border-color: #d1d5db;
            background: #f8fafc;
        }

        .photo-upload-box.grey:hover {
            border-color: #6c5ce7;
        }

        .photo-upload-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            pointer-events: none;
        }

        .photo-upload-box.grey:hover .photo-upload-content i {
            color: #a259f7 !important;
        }

        .photo-upload-box img.upload-thumb {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            border-radius: 8px;
        }

        .remove-photo {
            position: absolute;
            top: 2px;
            right: 2px;
            width: 20px;
            height: 20px;
            background: rgba(239, 68, 68, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            z-index: 10;
            transition: all 0.2s ease;
        }

        .remove-photo:hover {
            background: rgba(239, 68, 68, 1);
            transform: scale(1.1);
        }

        .test-row {
            display: flex;
            align-items: center;
            gap: 20px;
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
        }

        .test-info {
            flex: 1;
        }

        .status {
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            font-weight: bold;
        }

        .status.working {
            background: #d1fae5;
            color: #065f46;
        }

        .status.testing {
            background: #fef3c7;
            color: #92400e;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üì∏ Photo Upload Functionality Test</h1>
        <p>Click on any photo box below to test the upload functionality:</p>

        <div class="test-row">
            <div class="photo-upload-box grey" title="Click to upload photo">
                <input type="file" accept="image/*" style="display: none" />
                <div class="photo-upload-content">
                    <i class="ri-image-add-line" style="font-size: 1.2rem; color: #a259f7"></i>
                </div>
            </div>
            <div class="test-info">
                <h3>Test Photo Box 1</h3>
                <p>Standard photo upload box with validation</p>
                <span class="status testing">Click to test</span>
            </div>
        </div>

        <div class="test-row">
            <div class="photo-upload-box grey" title="Click to upload photo">
                <input type="file" accept="image/*" style="display: none" />
                <div class="photo-upload-content">
                    <i class="ri-image-add-line" style="font-size: 1.2rem; color: #a259f7"></i>
                </div>
            </div>
            <div class="test-info">
                <h3>Test Photo Box 2</h3>
                <p>Another photo upload box for testing</p>
                <span class="status testing">Click to test</span>
            </div>
        </div>

        <div class="test-row">
            <div class="photo-upload-box grey" title="Click to upload photo">
                <input type="file" accept="image/*" style="display: none" />
                <div class="photo-upload-content">
                    <i class="ri-image-add-line" style="font-size: 1.2rem; color: #a259f7"></i>
                </div>
            </div>
            <div class="test-info">
                <h3>Test Photo Box 3</h3>
                <p>Third photo upload box for comprehensive testing</p>
                <span class="status testing">Click to test</span>
            </div>
        </div>

        <div style="margin-top: 30px; padding: 15px; background: #f0f9ff; border-radius: 8px;">
            <h3>üß™ Test Instructions:</h3>
            <ol>
                <li>Click on any photo box above</li>
                <li>Select an image file (JPG, PNG, GIF)</li>
                <li>Verify the image preview appears</li>
                <li>Test the remove button (red X)</li>
                <li>Try uploading different file types to test validation</li>
            </ol>
        </div>

        <div style="margin-top: 20px; padding: 15px; background: #fef2f2; border-radius: 8px;">
            <h3>‚ö†Ô∏è Expected Behavior:</h3>
            <ul>
                <li>‚úÖ Image files should upload and show preview</li>
                <li>‚úÖ Non-image files should show error message</li>
                <li>‚úÖ Files over 5MB should show error message</li>
                <li>‚úÖ Remove button should clear the image</li>
                <li>‚úÖ Hover effects should work</li>
            </ul>
        </div>
    </div>

    <script>
        // Enhanced photo upload functionality with event delegation
        document.addEventListener("click", function(e) {
            const photoBox = e.target.closest(".photo-upload-box");
            if (!photoBox) return;
            
            // Don't trigger on existing images or remove buttons
            if (e.target.tagName === "IMG" || 
                e.target.classList.contains("remove-photo") ||
                e.target.closest(".remove-photo")) {
                return;
            }
            
            console.log("Photo box clicked:", photoBox);
            
            const input = photoBox.querySelector('input[type="file"]');
            if (input) {
                e.preventDefault();
                e.stopPropagation();
                input.click();
                
                // Update status
                const statusEl = photoBox.closest('.test-row').querySelector('.status');
                if (statusEl) {
                    statusEl.textContent = 'File dialog opened...';
                    statusEl.className = 'status testing';
                }
                
                // Ensure the input has a change handler
                if (!input.dataset.hasHandler) {
                    input.dataset.hasHandler = "true";
                    input.addEventListener("change", function(changeEvent) {
                        const file = this.files && this.files[0];
                        console.log("File selected:", file);
                        
                        const statusEl = photoBox.closest('.test-row').querySelector('.status');
                        
                        if (file) {
                            // Validate file type
                            if (!file.type.startsWith("image/")) {
                                alert("Please select a valid image file.");
                                this.value = "";
                                if (statusEl) {
                                    statusEl.textContent = 'Invalid file type';
                                    statusEl.className = 'status testing';
                                }
                                return;
                            }
                            
                            // Validate file size (max 5MB)
                            if (file.size > 5 * 1024 * 1024) {
                                alert("Image file size must be less than 5MB.");
                                this.value = "";
                                if (statusEl) {
                                    statusEl.textContent = 'File too large';
                                    statusEl.className = 'status testing';
                                }
                                return;
                            }
                            
                            if (statusEl) {
                                statusEl.textContent = 'Processing image...';
                                statusEl.className = 'status testing';
                            }
                            
                            // Create preview
                            const reader = new FileReader();
                            reader.onload = function(ev) {
                                // Clear existing images
                                const existingImages = photoBox.querySelectorAll("img.upload-thumb");
                                existingImages.forEach(img => img.remove());
                                
                                // Clear existing remove buttons
                                const existingRemove = photoBox.querySelectorAll(".remove-photo");
                                existingRemove.forEach(btn => btn.remove());
                                
                                // Create image element
                                const img = document.createElement("img");
                                img.className = "upload-thumb";
                                img.src = ev.target.result;
                                img.alt = "Variant photo";
                                img.style.cssText = `
                                    width: 100%; 
                                    height: 100%; 
                                    object-fit: cover; 
                                    border-radius: 8px; 
                                    display: block;
                                    position: absolute;
                                    top: 0;
                                    left: 0;
                                `;
                                
                                // Create remove button
                                const removeBtn = document.createElement("button");
                                removeBtn.type = "button";
                                removeBtn.className = "remove-photo";
                                removeBtn.innerHTML = '<i class="ri-close-line"></i>';
                                removeBtn.style.cssText = `
                                    position: absolute;
                                    top: 2px;
                                    right: 2px;
                                    width: 20px;
                                    height: 20px;
                                    background: rgba(239, 68, 68, 0.9);
                                    color: white;
                                    border: none;
                                    border-radius: 50%;
                                    cursor: pointer;
                                    display: flex;
                                    align-items: center;
                                    justify-content: center;
                                    font-size: 12px;
                                    z-index: 10;
                                `;
                                
                                removeBtn.addEventListener("click", function(removeEvent) {
                                    removeEvent.preventDefault();
                                    removeEvent.stopPropagation();
                                    input.value = "";
                                    img.remove();
                                    removeBtn.remove();
                                    const placeholder = photoBox.querySelector(".photo-upload-content");
                                    if (placeholder) placeholder.style.display = "";
                                    photoBox.style.position = "";
                                    
                                    if (statusEl) {
                                        statusEl.textContent = 'Image removed';
                                        statusEl.className = 'status testing';
                                    }
                                });
                                
                                // Hide placeholder and add image
                                const placeholder = photoBox.querySelector(".photo-upload-content");
                                if (placeholder) placeholder.style.display = "none";
                                photoBox.style.position = "relative";
                                photoBox.appendChild(img);
                                photoBox.appendChild(removeBtn);
                                
                                if (statusEl) {
                                    statusEl.textContent = 'Upload successful!';
                                    statusEl.className = 'status working';
                                }
                                
                                console.log("Photo preview created successfully");
                            };
                            
                            reader.onerror = function() {
                                console.error("Error reading file");
                                alert("Error reading the selected file. Please try again.");
                                if (statusEl) {
                                    statusEl.textContent = 'Error reading file';
                                    statusEl.className = 'status testing';
                                }
                            };
                            
                            reader.readAsDataURL(file);
                        } else {
                            if (statusEl) {
                                statusEl.textContent = 'No file selected';
                                statusEl.className = 'status testing';
                            }
                        }
                    });
                }
            } else {
                console.error("No file input found in photo box");
            }
        });

        console.log("Photo upload test page loaded");
    </script>
</body>
</html>